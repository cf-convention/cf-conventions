<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      #140 (Clarifying the role of attributes on boundary variables.)
     – CF Metadata
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/trac/search" />
        <link rel="prev" href="./139.html" title="ticket #139" />
        <link rel="last" href="./176.html" title="ticket #176" />
        <link rel="help" href="/trac/wiki/TracGuide" />
        <link rel="alternate" href="./140?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" /><link rel="alternate" href="./140?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="./140?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" />
        <link rel="next" href="./141.html" title="ticket #141" />
        <link rel="start" href="/trac/wiki" />
        <link rel="stylesheet" href="/trac/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/trac/chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="./1.html" title="ticket #1" />
        <link rel="shortcut icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
    <style id="trac-noscript" type="text/css">.trac-noscript { display: none !important }</style>
      <link type="application/opensearchdescription+xml" rel="search" href="/trac/search/opensearch" title="Search CF Metadata" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="b8aeac20bf7fd49b63339caa";
      var comments_prefs={"comments_only":"false","comments_order":"oldest"};
    </script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/folding.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/wikitoolbar.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/resizer.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/auto_preview.js"></script>
    <script type="text/javascript">
      jQuery("#trac-noscript").remove();
      jQuery(document).ready(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <script type="text/javascript" src="/trac/chrome/common/js/threaded_comments.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
      /*<![CDATA[*/
        $("#attachments").toggleClass("collapsed");
        $("#trac-up-attachments").click(function () {
          $("#attachments").removeClass("collapsed");
          return true;
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
        function setRevertHandler() {
          $("button.trac-revert").click(function() {
            var div = $("div", this);
            var field_name = div[0].id.substr(7);
            var field_value = div.text();
            var input = $("#propertyform *[name=field_" + field_name + "]");
            if (input.length > 0) {
              if (input.filter("input[type=radio]").length > 0) {
                input.val([field_value]);
              } else if (input.filter("input[type=checkbox]").length > 0) {
                input.val(field_value == "1" ? [field_value] : []);
              } else {
                input.val(field_value);
              }
            } else { // Special case for CC checkbox
              input = $("#propertyform input[name=cc_update]").val([]);
            }
            input.change();
            $(this).closest("li").remove();
            return false;
          });
        }
        setRevertHandler();
        var comment_focused = false;
        $("#comment").focus(function() { comment_focused = true; })
                     .blur(function() { comment_focused = false; });
        $("#propertyform").autoSubmit({preview: '1'}, function(data, reply) {
          var items = $(reply);
          // Update ticket box
          $("#ticket").replaceWith(items.filter('#ticket'));
          // Update changelog with original order
          $("#changelog").replaceWith(items.filter("#changelog"));
          // Reorder comments
          applyCommentsOrder(
            $('#prefs input[name="trac-comments-order"]:checked').val());
          // Show warning
          var new_changes = $("#changelog .trac-new");
          $("#trac-edit-warning").toggle(new_changes.length != 0);
          if (new_changes.length != 0)
            $("#changelog").parent().show().removeClass("collapsed");
          // Update view time
          $("#propertyform input[name='view_time']").replaceWith(items.filter("input[name='view_time']"));
          // Update preview
          var preview = $("#ticketchange").html(items.filter('#preview').children());
          var show_preview = preview.children().length != 0;
          $("#ticketchange").toggle(show_preview);
          setRevertHandler();
          // Collapse property form if comment editor has focus
          if (show_preview && comment_focused)
            $("#modify").parent().addClass("collapsed");
          // Execute scripts to load stylesheets
          items.filter("script").appendTo("head");
        }, "#ticketchange .trac-loading");
        $("#trac-comment-editor").autoSubmit({preview_comment: '1'}, function(data, reply) {
          var comment = $("#trac-comment-editor").next("div.comment").html(reply);
          comment.toggle(comment.children().length != 0);
        }, "#changelog .trac-loading");
        /*]]>*/
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://cf-trac.llnl.gov/trac"><img src="/trac/chrome/site/cf_logo.png" alt="CF Metadata Trac" height="80" width="400" /></a>
      </div>
      <form id="search" action="/trac/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/trac/login">Login</a></li><li><a href="/trac/about">About Trac</a></li><li><a href="/trac/prefs">Preferences</a></li><li class="last"><a href="/trac/wiki/TracGuide">Help/Guide</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/trac/query">View Tickets</a></li><li><a href="/trac/roadmap">Roadmap</a></li><li><a href="/trac/timeline">Timeline</a></li><li><a href="/trac/search">Search</a></li><li class="last"><a href="/trac/wiki">Wiki</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li class="first"><span>&larr; <a class="prev" href="./139.html" title="ticket #139">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="./141.html" title="ticket #141">Next Ticket</a> &rarr;</span></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
        <div id="ticket" class="trac-content ">
  <div class="date">
    <p>Opened <a class="timeline" href="/trac/timeline?from=2015-05-08T08%3A57%3A13-07%3A00&amp;precision=second" title="See timeline at 05/08/15 08:57:13">6 years ago</a></p>
    <p>Closed <a class="timeline" href="/trac/timeline?from=2017-07-03T16%3A42%3A54-07%3A00&amp;precision=second" title="See timeline at 07/03/17 16:42:54">4 years ago</a></p>
  </div>
  <h2>
    <a href="./140.html" class="trac-id">#140</a>
    <span class="trac-status">
      <a href="/trac/query?status=closed">closed</a>
    </span>
    <span class="trac-type">
      <a href="/trac/query?status=!closed&amp;type=enhancement">enhancement</a>
    </span>
    <span class="trac-resolution">
      (<a href="/trac/query?status=closed&amp;resolution=fixed">fixed</a>)
    </span>
  </h2>
  <h1 id="trac-ticket-title" class="searchable">
    <span class="summary">Clarifying the role of attributes on boundary variables.</span>
  </h1>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable"><a href="/trac/query?status=!closed&amp;reporter=davidhassell">davidhassell</a></td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">cf-conventions@…</td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/trac/query?status=!closed&amp;priority=medium">medium</a>
        </td>
        <th id="h_milestone" class="missing">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="missing milestone"></a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/trac/query?status=!closed&amp;component=cf-conventions">cf-conventions</a>
        </td>
        <th id="h_version" class="missing">
          Version:
        </th>
        <td headers="h_version">
              <a href="/trac/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="/trac/query?status=!closed&amp;keywords=~boundary">boundary</a> <a href="/trac/query?status=!closed&amp;keywords=~variable">variable</a>, <a href="/trac/query?status=!closed&amp;keywords=~attribute">attribute</a>
        </td>
        <th id="h_cc" class="missing">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <h2 id="a1.Title">1. Title</h2>
<blockquote>
<p>
Clarifying the role of attributes on boundary variables.
</p>
</blockquote>
<h2 id="a2.Moderator">2. Moderator</h2>
<blockquote>
<p>
TBC (any offer will be gladly accepted).
</p>
</blockquote>
<h2 id="a3.Requirement">3. Requirement</h2>
<blockquote>
<p>
To disallow inconsistencies between particular attributes of a
boundary variable and its associated coordinate or auxiliary
coordinate variable.
</p>
</blockquote>
<blockquote>
<p>
For example, it is currently possible for a boundary variable to
have a different <tt>standard_name</tt> attribute to its associated
coordinate or auxiliary coordinate variable. This would be
unsatisfactory because the user of the data cannot know which of
the possibilities is correct.
</p>
</blockquote>
<blockquote>
<p>
It is proposed that if a boundary variable has attributes which
determine the coordinate type (<tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt> and
<tt>positive</tt>) or those which affect the interpretation of the boundary
variable array values (<tt>units</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> and
<tt>month_lengths</tt>) then they must always agree exactly with the same
attributes of its associated coordinate or auxiliary coordinate
variable. In addition, it is recommended that these attributes are
not provided to a boundary variable since they are already
inherited implicitly.
</p>
</blockquote>
<blockquote>
<p>
No restriction is made on any other boundary variable attributes.
</p>
</blockquote>
<blockquote>
<p>
This does not affect datasets encoded with previous versions of CF
</p>
</blockquote>
<h2 id="a4.InitialStatementofTechnicalProposal">4. Initial Statement of Technical Proposal</h2>
<blockquote>
<p>
The following changes should be made to section 7.1. Cell Boundaries
(additions marked by <em>TEXT</em>, deletions by <del>TEXT</del>):
</p>
</blockquote>
<blockquote>
<blockquote>
<p>
To represent cells we add the attribute bounds to the appropriate
coordinate variable(s). The value of bounds is the name of the
variable that contains the vertices of the cell boundaries. We
refer to this type of variable as a "boundary variable". A
boundary variable will have one more dimension than its
associated coordinate or auxiliary coordinate variable. The
additional dimension should be the most rapidly varying one, and
its size is the maximum number of cell vertices. Since a boundary
variable is considered to be part of a coordinate variable's
metadata, it is not necessary to provide it with attributes (such
as <tt>long_name</tt> and <tt>units</tt>)<del>.</del> <em>and providing no attributes
is always acceptable. Boundary variable attributes which
determine the coordinate type (<tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt> and
<tt>positive</tt>) or those which affect the interpretation of the array
values (<tt>units</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> and 
<tt>month_lengths</tt>) must always agree exactly with the same attributes of
its associated coordinate or auxiliary coordinate variable. To avoid
duplication, however, it is recommended that the attributes <tt>units</tt>,
<tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>, <tt>calendar</tt>, <tt>leap_month</tt>,
<tt>leap_year</tt> and <tt>month_lengths</tt> are not provided to a boundary
variable.</em>
</p>
</blockquote>
</blockquote>
<blockquote>
<p>
In section 7.1 Cell Boundaries of the conformance document
(additions marked by <em>TEXT</em>, deletions by <del>TEXT</del>):
</p>
</blockquote>
<ul><li>Requirements:
<ul><li>The type of the bounds attribute is a string whose value is a
single variable name. The specified variable must exist in the
file.
</li><li>A boundary variable must have the same dimensions as its
associated variable, plus have a trailing dimension (CDL order)
for the maximum number of vertices in a cell.
</li><li>A boundary variable must be a numeric data type.
</li><li>If a boundary variable has <del><tt>units</tt> or <tt>standard_name</tt>
attributes, they must agree with those of its associated
variable.</del> <em><tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>,
<tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> and <tt>month_lengths</tt> 
attributes, they must agree exactly with those of its associated
variable.</em>
</li></ul></li></ul><ul><li>Recommendations:
<ul><li>The points specified by a coordinate or auxiliary coordinate
variable should lie within, or on the boundary, of the cells
specified by the associated boundary variable.
</li><li>Boundary variables should not have the <del><tt>_FillValue</tt> or
<tt>missing_value</tt></del> <em><tt>_FillValue</tt>, <tt>missing_value</tt>, <tt>units</tt>,
<tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>, <tt>calendar</tt>, <tt>leap_month</tt>,
<tt>leap_year</tt> or <tt>month_lengths</tt></em> attributes.
</li></ul></li></ul><h2 id="a5.Benefits">5. Benefits</h2>
<blockquote>
<p>
It would be disallowed to encode type-determining attributes
(<tt>units</tt>, <tt>calendar</tt>, <tt>standard_name</tt>, <tt>axis</tt> and <tt>positive</tt>) or array
value interpretation attirbutes (<tt>units</tt>, <tt>calendar</tt>, <tt>leap_month</tt>,
<tt>leap_year</tt> and <tt>month_lengths</tt>) on a boundary variable if they conflict
with the associated coordinate or auxiliary coordinate variable.
</p>
</blockquote>
<h2 id="a6.StatusQuo">6. Status Quo</h2>
<blockquote>
<p>
Attributes on a boundary variable may conflict with the associated
coordinate or auxiliary coordinate variable, and this is not always
checked by the CF checker.
</p>
</blockquote>
<blockquote>
<p>
This proposal does not affect datasets encoded under previous
versions of CF, other than via the potential for extra warnings
being raised by the CF checker.
</p>
</blockquote>
<p>
David Hassell
</p>

    </div>
  </div>
</div>
          

        <div>
          <div class="trac-noscript" style="position: relative">
            <form id="prefs" method="get" action="/trac/prefs" style="position: absolute; right: 0">
              <div id="trac-comments-order">
                <input type="radio" id="trac-comments-oldest" name="trac-comments-order" value="oldest" checked="checked" />
                <label for="trac-comments-oldest">Oldest first</label>
                <input type="radio" id="trac-comments-newest" name="trac-comments-order" value="newest" />
                <label for="trac-comments-newest">Newest first</label>
                <span id="trac-threaded-toggle" style="display: none">
                  <input type="radio" id="trac-comments-threaded" name="trac-comments-order" value="threaded" />
                  <label for="trac-comments-threaded">Threaded</label>
                </span>
              </div>
              <div>
                <input id="trac-comments-only-toggle" type="checkbox" />
                <label for="trac-comments-only-toggle">Comments only</label>
              </div>
            </form>
          </div>
          <h3 class="foldable">Change History <span class="trac-count">(32)</span></h3>
          <div id="changelog">
              <div class="change" id="trac-change-1-1431103050762885">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:1" class="cnum">
    <a href="#comment:1">comment:1</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2015-05-08T09%3A37%3A30-07%3A00&amp;precision=second" title="See timeline at 05/08/15 09:37:30">6 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Thank you for making this proposal, which I support.
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2-1490211991376554">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:2" class="cnum">
    <a href="#comment:2">comment:2</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-03-22T12%3A46%3A31-07%3A00&amp;precision=second" title="See timeline at 03/22/17 12:46:31">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
I support this proposal with the caveat that if we allow formula_terms on parametric coordinate *bounds* (as I've advocated in ticket <a class="closed ticket" href="./147.html" title="defect: clarification of standard and correction of conformance doc: formula_terms (closed: fixed)">#147</a>, then we might want to include some mention here that the formula_terms attached to the bounds should be consistent with the formula_terms attached to the parametric coordinate variable itself. By "consistent" I mean that the same parameters must be defined (but of course the parameter values will be stored in different variables from the parameters of the coordinates themselves).
</p>
<p>
thanks, David, for proposing this change.
</p>
<p>
best regards,
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3-1490215781740733">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:3" class="cnum">
    <a href="#comment:3">comment:3</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-03-22T13%3A49%3A41-07%3A00&amp;precision=second" title="See timeline at 03/22/17 13:49:41">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Karl,
</p>
<p>
I agree with your note on <tt>formula_terms</tt>. I would go further to say that if the parent coordinate variable also has <tt>formula_terms</tt> which refers to a variable with bounds then those bounds must be referred to by same parameter of the bounds' <tt>formula_terms</tt>.
</p>
<p>
I'll draft some text to add to the section 7.1 and conformance changes proposed above...
</p>
<p>
Thanks, David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4-1490219242008762">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:4" class="cnum">
    <a href="#comment:4">comment:4</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-03-22T14%3A47%3A22-07%3A00&amp;precision=second" title="See timeline at 03/22/17 14:47:22">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Proposed first paragraph of section 7.1. Cell Boundaries (original additions marked by <em>TEXT</em>, deletions by <del>TEXT</del>, new additions in <em> <strong>TEXT</strong> </em>):
</p>
<blockquote>
<p>
To represent cells we add the attribute bounds to the appropriate coordinate variable(s). The value of bounds is the name of the variable that contains the vertices of the cell boundaries. We refer to this type of variable as a "boundary variable". A boundary variable will have one more dimension than its associated coordinate or auxiliary coordinate variable. The additional dimension should be the most rapidly varying one, and its size is the maximum number of cell vertices. Since a boundary variable is considered to be part of a coordinate variable's metadata, it is not necessary to provide it with attributes (such as <tt>long_name</tt> and <tt>units</tt>)<del>.</del> <em>and providing no attributes is always acceptable. Boundary variable attributes which determine the coordinate type (<tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt> and <tt>positive</tt>) or those which affect the interpretation of the array values (<tt>units</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> and <tt>month_lengths</tt>) must always agree exactly with the same attributes of its associated coordinate or auxiliary coordinate variable. To avoid duplication, however, it is recommended that the attributes <tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> and <tt>month_lengths</tt> are not provided to a boundary variable. <strong>If the associated variable is a parametric coordinate variable with a <tt>formula_terms</tt> attribute (ref section 4.3.2) then two cases are possible</strong>
</em></p>
</blockquote>
<blockquote>
<blockquote>
<p>
<em> <strong>1) if the boundary variable also has a <tt>formula_terms</tt> attribute then its terms must be the same as those for the parametric coordinate variable, but with different variables named as term values and using, wherever possible, the boundary variables of variables named by  parametric coordinate variable's <tt>formula_terms</tt></strong> </em>
</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>
<em> <strong>2) if the boundary variable does not have a <tt>formula_terms</tt> attribute then it is assumed that the <tt>formula_terms</tt> of the parametric coordinate variable applies, substituting a named variable with its boundary variable, wherever possible </strong> </em>
</p>
</blockquote>
</blockquote>
<p>
We'll also need some extra changes to the conformance document ...
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5-1490225085496046">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:5" class="cnum">
    <a href="#comment:5">comment:5</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-03-22T16%3A24%3A45-07%3A00&amp;precision=second" title="See timeline at 03/22/17 16:24:45">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Just to note:  This would be much less complicated if we decide to reject Jonathan's alternative under ticket <a class="closed ticket" href="./147.html" title="defect: clarification of standard and correction of conformance doc: formula_terms (closed: fixed)">#147</a>.  Then the new text would read:
</p>
<blockquote>
<p>
If the boundary variable is associated with a parametric coordinate variable and both the coordinate variable and the boundary variable have formula_terms (ref section 4.3.2), then the terms in the formula definition must be the same for the coordinates and its bounds, but with different parametric variable names specified for any terms in the definition that depend on the vertical coordinate.
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-6-1490258485197269">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:6" class="cnum">
    <a href="#comment:6">comment:6</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-03-23T01%3A41%3A25-07%3A00&amp;precision=second" title="See timeline at 03/23/17 01:41:25">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi Karl,
</p>
<p>
I like this approach, but I think we can retain your clarity whilst retaining Jonathan's alternative:
</p>
<blockquote>
<p>
If the boundary variable is associated with a parametric coordinate variable then it assumed that the formula definition of the parametric coordinate variable also applies to the bounds. The term values are the same except when the named variable depends on the vertical coordinate, in which case the named variable is substituted with its boundary variable, if it exists. Note that a <tt>formula_terms</tt> attribute may also be provided on a boundary variable provided it adheres to these restrictions.
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-7-1490293069094233">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:7" class="cnum">
    <a href="#comment:7">comment:7</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-03-23T11%3A17%3A49-07%3A00&amp;precision=second" title="See timeline at 03/23/17 11:17:49">4 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Karl and David
</p>
<p>
I don't understand why Karl thinks the 1D formula terms (things like sigma values) are not anything like coordinate data. I have the same view as David that they do contain something like coordinate data, even though they're not coordinates by themselves. Evidently they <em>do</em> have bounds; in Karl's preferred arrangement (David's second case in comment 21 of ticket 147), <tt>hybrid_sigma:formula_terms</tt> points to <tt>A_bounds</tt> and <tt>B_bounds</tt>. If you don't call these boundary variables, what are they? If they are boundary variables, why not point to them with a <tt>bounds</tt> attribute? However since we've said all these things already, and know each other's point of view, it must be some philosophical disagreement. We'll have to arrange a conference about it sometime!
</p>
<p>
There is an important advantage in Karl's arrangement that you don't have to work out the identities of the formula terms for the bounds, since there's a <tt>formula_terms</tt> attribute to tell you them explicitly. What if we make it <em>mandatory</em> for the bounds variable of a parametric vertical coordinate to have a <tt>formula_terms</tt> attribute? This would be a backward-incompatible change, in the sense that data that was compliant with earlier versions of CF might not be compliant with the new version.
</p>
<p>
That would simplify the text here. Starting from the bold bit, we would have
</p>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt> attribute (ref section 4.3.2) also has a <tt>bounds</tt> attribute, its boundary variable must have a <tt>formula_terms</tt> attribute too. Because the same <tt>standard_name</tt> must describe both variables, the formula must have the same terms (as specified in Appendix D), but a different variable must be named by the two <tt>formula_terms</tt> attributes for any term which depends on the vertical dimension, because the boundary variables have one more dimension.
</p>
</blockquote>
<p>
Then my preferred arrangement can be permitted by further text
</p>
<blockquote>
<p>
The boundary variables for these formula terms may also be identified by <tt>bounds</tt> attributes of the formula terms variables. In that case, the <tt>formula_terms</tt> of the boundary variable and the <tt>bounds</tt> of the formula terms variables must be consistent.
</p>
</blockquote>
<p>
So this permits David's case 2 and the case 3 I wrote down in ticket 147, but not David's case 1, which Karl doesn't like. In Martin's list in comment 20 of ticket 147, I would advocate option 4 - do nothing. We always permit non-standardised attributes in CF. The <tt>formula_terms</tt> attribute used other than for variables containing coordinate data (in the broad sense in which David and I interpret it) doesn't mean anything to CF, but it's allowed. It may have a meaning to the data-writer. Of course, it might be a mistake as well, but we don't police such mistakes. We have no general prohibition of or recommendation against using attributes from Appendix A in situations where CF doesn't describe their use.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8-1490301076552629">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:8" class="cnum">
    <a href="#comment:8">comment:8</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-03-23T13%3A31%3A16-07%3A00&amp;precision=second" title="See timeline at 03/23/17 13:31:16">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hello Karl, Jonathan,
</p>
<p>
Allowing the term values which span the vertical dimension to <em>not</em> have a <tt>bounds</tt> attribute would certainly make writing software harder, as the software would have to work out that a formula terms named variable is associated with a boundary variable and then make that connection explicit.
</p>
<p>
Running with Jonathan's idea of insisting that the boundary variable has a <tt>formula_terms</tt> attribute, I would take it further and insist that term values which span the vertical dimension <em>must</em> have a <tt>bounds</tt> attribute which points to the appropriate variable named in the boundary variable's <tt>formula_terms</tt> for its boundary variable. This is also a backwards-incompatible change:
</p>
<blockquote>
<p>
If a parametric coordinate variable with a formula_terms attribute (ref section 4.3.2) also has a bounds attribute, its boundary variable must have a <tt>formula_terms</tt> attribute too. Because the same standard_name must describe both variables, the formula must have the same terms (as specified in Appendix D), but a different variable must be named by the two <tt>formula_terms</tt> attributes for any term which depends on the vertical dimension, because the boundary variables have one more dimension. For these terms, the boundary variable's <tt>formula_terms</tt> must name the bounds of the variables named by the vertical coordinate variable's <tt>formula_terms</tt>.
</p>
</blockquote>
<p>
That said, I like to think that we can find some non-confusing wording which allows my case 1, and so no backward-incompatible changes would be necessary.
</p>
<p>
All the best,
</p>
<p>
David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9-1490303311439264">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:9" class="cnum">
    <a href="#comment:9">comment:9</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-03-23T14%3A08%3A31-07%3A00&amp;precision=second" title="See timeline at 03/23/17 14:08:31">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi David,
</p>
<p>
Could you expand on why you think software will want to extract the so-called "bounds" values for variables appearing in formula_terms along with the values themselves?   I would have thought that for parametric coordinates you would want to primarily associate formula terms with the coordinate values they are used to transform.  So for the coordinates themselves you would associate the parameter values in the formula_terms that is attached to the parametric coordinate.  For the *bounds* on that coordinate you would associate the parameter values in the formula_terms attached to the parametric coordinate's bounds.  
</p>
<p>
Why is there any need to associate the parameter values used for coordinate bound transformations with the parameter values used for coordinate transformations.  I should think these two sets of parameter values will invariably be used independently. I suppose one might want to put into a container all the coordinate and bound information, but I don't think you would ever put the coordinate information and the coordinate and bounds parameters together without also including the coordinate bounds themselves.  If this is the case then your code could easily construct such a container without a "bounds" attribute attached to the parameter variables.  
</p>
<p>
I'm sorry if I'm a bit slow on this, but you seem to have a specific use case where "working out" needed relationships is difficult.  Could you describe it in a bit more detail?  This could help us reach consensus.
</p>
<p>
Sorry this seems to be taking up your valuable time, but I assure you if there is a compelling use case, then I'll favor including Jonathan's alternative. 
</p>
<p>
best regards,
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10-1493821068557429">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:10" class="cnum">
    <a href="#comment:10">comment:10</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-03T07%3A17%3A48-07%3A00&amp;precision=second" title="See timeline at 05/03/17 07:17:48">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hello Karl, Jonathan and all,
</p>
<p>
It'd be nice to wrap this up! How about this text, which says "feel
free to put formula_terms on bounds, but if they're not there then
infer them from the parent parametric coordinate"
</p>
<blockquote>
<p>
If a parametric coordinate variable with a formula_terms attribute
(ref section 4.3.2) also has a bounds attribute, then that formula
must also be associated with the boundary variable, because the
same <tt>standard_name</tt> describes both variables. The association is
explicit if the boundary variable also has a <tt>formula_terms</tt>
attribute defining the same terms (as specified in Appendix D),
but a different variable must be named for any term which depends
on the vertical dimension, because the boundary variables have one
more dimension. If the association is implicit then the
<tt>formula_terms</tt> attribute is omitted from the boundary variable
and it is assumed that the <tt>formula_terms</tt> attribute from the
parametric coordinate variable applies, but for any term which
depends on the vertical dimension, the named variable is replaced
with its boundary variable. In this case, such named variables
must be auxiliary coordinate variables with associated boundary
variabes.
</p>
</blockquote>
<p>
Explicit example:
</p>
<pre class="wiki"> float eta(eta) ;
   eta:long_name = "eta at layer midpoints" ;
   eta:positive = "down" ;
   eta:standard_name = " atmosphere_hybrid_sigma_pressure_coordinate" ;
   eta:formula_terms = "a: a b: b ps: ps p0:p0”;
   eta:bounds="etabnds";
 float etabnds(eta,2);
   etabnds:formula_terms = " a: abnds b: bbnds ps: ps p0:p0" ;
 float a(eta);
   a:long_name = "’a’ coefficient for vertical coordinate (at full levels)";
   a:units = ‘Pa’ 
 float b(eta);
   b:long_name = "’b’ coefficient for vertical coordinate (at full levels)";
   b:units = ‘Pa Pa-1’
 float abnds(eta,2);
   abnds:long_name = "’a’ coefficient for vertical coordinate (at half-levels)";
 float bbnds(eta,2);
   bbnds:long_name = "’b’ coefficient for vertical coordinate (at half-levels)";
 float ps(lat, lon);
   ps.units = 'Pa';
 float p0; 
   p0.units = 'Pa';
 float T(eta,lat,lon);
   T:standard_name="air_temperature";
   T:units="K";
</pre><p>
Implicit example:
</p>
<pre class="wiki"> float eta(eta) ;
   eta:long_name = "eta at layer midpoints" ;
   eta:positive = "down" ;
   eta:standard_name = " atmosphere_hybrid_sigma_pressure_coordinate" ;
   eta:formula_terms = "a: a b: b ps: ps p0:p0”;
   eta:bounds="etabnds";
 float etabnds(eta,2);
 float a(eta);
   a:long_name = "’a’ coefficient for vertical coordinate (at full levels)";
   a:units = ‘Pa’
   a:bounds = "abnds";
 float b(eta);
   b:long_name = "’b’ coefficient for vertical coordinate (at full levels)";
   b:units = ‘Pa Pa-1’
   b:bounds = "bbnds";	
 float abnds(eta,2);
 float bbnds(eta,2);
 float ps(lat, lon);
   ps.units = 'Pa';
 float p0; 
   p0.units = 'Pa';
 float T(eta,lat,lon);
   T:standard_name="air_temperature";
   T:units="K";
   T:coordinates="a b";
</pre><p>
Note also that there is nothing stopping the two methods being
combined, which the checker would have to look out for. E.g.
</p>
<pre class="wiki"> float eta(eta) ;
   eta:long_name = "eta at layer midpoints" ;
   eta:positive = "down" ;
   eta:standard_name = " atmosphere_hybrid_sigma_pressure_coordinate" ;
   eta:formula_terms = "a: a b: b ps: ps p0:p0”;
   eta:bounds="etabnds";
 float etabnds(eta,2);
   etabnds:formula_terms = " a: abnds b: bbnds ps: ps p0:p0" ;
 float a(eta);
   a:long_name = "’a’ coefficient for vertical coordinate (at full levels)";
   a:units = ‘Pa’ 
   a.bounds = 'abnds';
 float b(eta);
   b:long_name = "’b’ coefficient for vertical coordinate (at full levels)";
   b:units = 'Pa Pa-1';
   b.bounds = 'bbnds';
 float abnds(eta,2);
 float bbnds(eta,2);
 float ps(lat, lon);
   ps.units = 'Pa';
 float p0; 
   p0.units = 'Pa';
 float T(eta,lat,lon);
   T:standard_name="air_temperature";
   T:units="K";
   T.coordinates = 'a b';
</pre>
    </div>

              </div>
              <div class="change" id="trac-change-11-1493906340669766">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:11" class="cnum">
    <a href="#comment:11">comment:11</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-04T06%3A59%3A00-07%3A00&amp;precision=second" title="See timeline at 05/04/17 06:59:00">4 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear David
</p>
<p>
Thanks for your posting. I agree that we should resolve this for the sake of CMIP6 and CF - we could still get it into 1.7 if we agree now about it.
</p>
<p>
I would be happy with what you suggest, but I think that Karl wouldn't be. He think it's important that the bounds must have formula terms, so he would not like to allow your "Implicit" case. For the sake of reaching an agreement, I think it would be fine to require bounds to have formula terms (as Karl prefers), but I still want to permit formula terms to have bounds (as you and I prefer) and hence allow your "two methods" case.
</p>
<p>
That was the aim of the text I proposed in comment 7
</p>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt> attribute (ref section 4.3.2) also has a <tt>bounds</tt> attribute, its boundary variable must have a <tt>formula_terms</tt> attribute too. Because the same <tt>standard_name</tt> must describe both variables, the formula must have the same terms (as specified in Appendix D), but a different variable must be named by the two <tt>formula_terms</tt> attributes for any term which depends on the vertical dimension, because the boundary variables have one more dimension. The boundary variables for these formula terms may also be identified by <tt>bounds</tt> attributes of the formula terms variables. In that case, the <tt>formula_terms</tt> of the boundary variable and the <tt>bounds</tt> of the formula terms variables must be consistent.
</p>
</blockquote>
<p>
which would be well-illustrated by your "explicit" and "two methods" CDL.
</p>
<p>
What do you think, Karl?
</p>
<p>
Cheers
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12-1493921050074841">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:12" class="cnum">
    <a href="#comment:12">comment:12</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-04T11%3A04%3A10-07%3A00&amp;precision=second" title="See timeline at 05/04/17 11:04:10">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hello Jonathan, Karl,
</p>
<p>
I too prefer the "explicit" method, but am quite keen on keeping the "implicit" method to preserve backwards compatibility. To date, both methods have been allowed (by virtue of neither being disallowed), so to preclude the "implicit" method now would cause problems.
</p>
<p>
I would be more than happy to say that the "explicit" method is strongly recommended.
</p>
<p>
Note that the implicit method requires that formula_terms variables with bounds are auxiliary coordinate variables - otherwise their <tt>bounds</tt> attributes are not standardised.
</p>
<p>
Given all that, how about this text, which updates Jonathan's:
</p>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt> attribute
(ref section 4.3.2) also has a bounds attribute, it is strongly
recommended that its boundary variable has a <tt>formula_terms</tt>
attribute too. Because the same <tt>standard_name</tt> must describe both
variables, the formula must have the same terms (as specified in
Appendix D), but a different variable must be named by the two
<tt>formula_terms</tt> attributes for any term which depends on the vertical
dimension, because the boundary variables have one more dimension. The
boundary variables for these formula terms may also be identified by
<tt>bounds</tt> attributes of the formula terms variables that are auxiliary
coordinate variables. In that case, the <tt>formula_terms</tt> of the boundary
variable and the bounds of the formula terms variables must be
consistent. If the <tt>formula_terms</tt> attribute is omitted from the
boundary variable then it is assumed that the <tt>formula_terms</tt> attribute
from the parametric coordinate variable applies to the boundary
variable, but for any term which depends on the vertical dimension,
the named variable is replaced with its boundary variable. Therefore,
such a named variable must be an auxiliary coordinate variable with an
associated boundary variable.
</p>
</blockquote>
<p>
All the best,
</p>
<p>
David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13-1494655568057602">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:13" class="cnum">
    <a href="#comment:13">comment:13</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-12T23%3A06%3A08-07%3A00&amp;precision=second" title="See timeline at 05/12/17 23:06:08">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Thanks, David and Jonathon, for continuing to engage on this, because I agree that it is important to try to include this in 1.7 (in support of CMIP6).  I think there is probably no harm (and may be some virtue) in allowing the "implicit" case, so I support Jonathan's most recent proposal and David's amendment that "it is strongly recommended that its boundary variable has a formula_terms attribute too." 
</p>
<p>
I must confess that I didn't find the text added by David at the end, starting with "If the formula_terms attribute is omitted" to be helpful.  Perhaps it's the time of the evening or the afterglow of a nice glass of wine, but unless Jonathan thinks this text will be understandable and enlightening, then I would favor omitting it. 
</p>
<p>
Let's try to wrap this up.
</p>
<p>
Anyone else with any objections to the proposal?
</p>
<p>
best regards,
Karl   
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14-1494775615323616">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:14" class="cnum">
    <a href="#comment:14">comment:14</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:15" class="follow-up">↓ 15</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-14T08%3A26%3A55-07%3A00&amp;precision=second" title="See timeline at 05/14/17 08:26:55">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hello Karl,
</p>
<p>
On a re-read, I agree that we can omit text as you suggest. That would give (changing one "the" to an "a"):
</p>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt> attribute (ref section 4.3.2) also has a <tt>bounds</tt> attribute, it is strongly recommended that its boundary variable has a <tt>formula_terms</tt> attribute too. Because the same standard name must describe both variables, the formula must have the same terms (as specified in Appendix D), but a different variable must be named by the two <tt>formula_terms</tt> attributes for any term which depends on the vertical dimension, because the boundary variables have one more dimension. The boundary variables for these formula terms may also be identified by <tt>bounds</tt> attributes of the formula terms variables that are auxiliary coordinate variables. In that case, a <tt>formula_terms</tt> attribute of the boundary variable and the bounds of the formula terms variables must be consistent.
</p>
</blockquote>
<p>
Thanks, David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-15-1494845895739604">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:15" class="cnum">
    <a href="#comment:15">comment:15</a>
  </span>
        in reply to:
    <a href="#comment:14">↑ 14</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-15T03%3A58%3A15-07%3A00&amp;precision=second" title="See timeline at 05/15/17 03:58:15">4 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Karl and David
</p>
<p>
I agree with this text as well, thank you. I suggest a reordering of the penultimate sentence, and I think with this rewording "the" is better than "a" in the final sentence:
</p>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt> attribute (ref section 4.3.2) also has a <tt>bounds</tt> attribute, it is strongly recommended that its boundary variable has a <tt>formula_terms</tt> attribute too. Because the same standard name must describe both variables, the formula must have the same terms (as specified in Appendix D), but a different variable must be named by the two <tt>formula_terms</tt> attributes for any term which depends on the vertical dimension, because the boundary variables have one more dimension. In addition, any formula terms variable which is an auxiliary coordinate variable may have a <tt>bounds</tt> attribute to identify its boundary variable. In that case, the <tt>formula_terms</tt> attribute of the boundary variable and the <tt>bounds</tt> attribute of the formula terms variable must be consistent.
</p>
</blockquote>
<p>
I'm very glad we seem likely agree this at last! I think an example is also needed, as we previously discussed, presumably the one with both methods shown. David, please could you repeat the proposed example? Also, please could you draft the required changes to the conformance document? We can discuss that if you like.
</p>
<p>
I assume that if we accept this ticket we also accept the uncontroversial main part of David's proposal in the initial statement, about all the other attributes of boundary variables. I'm still happy with that part. Are you, Karl?
</p>
<p>
In addition, if we accept this ticket, we can close ticket 147, since this one has dealt with the issue. It's a long-standing issue in CF, and it's good to have it resolved!
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-16-1494849122073847">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:16" class="cnum">
    <a href="#comment:16">comment:16</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-15T04%3A52%3A02-07%3A00&amp;precision=second" title="See timeline at 05/15/17 04:52:02">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Jonathan and Karl,
</p>
<p>
I'm afraid that I don't favour the "the" in the last sentence. It implies to me that in this case there <em>has</em> to be a formula_terms attribute on the bounds, which is not the case. How about
</p>
<blockquote>
<p>
In that case, the <tt>bounds</tt> attribute of the formula terms variable must be consistent with the <tt>formula_terms</tt> attribute of the boundary variable, if present. 
</p>
</blockquote>
<p>
or leaving the whole sentence out and moving it to the conformance doc.
</p>
<p>
I shall re-check and re-post the example.
</p>
<p>
Many thanks,
</p>
<p>
David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17-1494852750668978">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:17" class="cnum">
    <a href="#comment:17">comment:17</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-15T05%3A52%3A30-07%3A00&amp;precision=second" title="See timeline at 05/15/17 05:52:30">4 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear David
</p>
<p>
Ah, I see what you mean by putting "a" - when I read it first I didn't pick up that implication. I think your new version of this sentence is fine, thanks. It should appear in the conventions document in order to provide the reason for the conformance document to state it as a requirement.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-18-1495147675733761">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:18" class="cnum">
    <a href="#comment:18">comment:18</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-18T15%3A47%3A55-07%3A00&amp;precision=second" title="See timeline at 05/18/17 15:47:55">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi David and Jonathan,
</p>
<p>
I was about to finally sign off on this when I realized what we’ve agreed upon isn’t entirely made clear in the text.  I thought Jonathan (in the generous spirit of “reaching an agreement”) proposed that although in the past neither explicit nor implicit methods were part of the standard, both were used (in different datasets).  For backward compatibility with these legacy datasets, software should be able to infer the formula_terms using either method, but going forward, we deprecate sole use of the implicit method (but allow it in addition to the explicit method).  If that is what we’ve agreed, then would the following text be clear?
</p>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt> attribute (ref section 4.3.2) also has a <tt>bounds</tt> attribute, its boundary variable must have a <tt>formula_terms</tt> attribute too. In this case the same terms would appear in both (as specified in Appendix D), since the transformation from the parametric coordinate values to physical space is realized through the same formula.  For any term that depends on the vertical dimension, however, the <em>variable names</em> appearing in the formula terms would differ from those found in the <tt>formula_terms</tt> of the coordinate variable itself  because the 2-dimensional bound locations do not generally coincide with the 1-dimensional coordinate locations.
</p>
</blockquote>
<blockquote>
<p>
Whenever a <tt>formula_terms</tt> attribute is attached to a boundary variable, the formula terms may additionally be identified using a second method:  the variables appearing in the vertical coordinate's <tt>formula_terms</tt> may be declared to be auxiliary coordinates, and those coordinates may have  <tt>bounds</tt> attributes that identify their boundary variables.  In that case, the <tt>bounds</tt> attribute of a formula terms variable must be consistent with the <tt>formula_terms</tt> attribute of the boundary variable.  Software digesting legacy datasets (constructed prior to version 1.7 of this standard) may have to rely in some cases on the first method of identifying the formula term variables and in other cases, on the second.  Henceforth, however, the first method will be sufficient.
</p>
</blockquote>
<p>
My impression is that Jonathan thought this would be o.k., but David was worried that disallowing sole use of the “implicit” (or second) approach might be problematic.
</p>
<p>
The "explicit" and "combined" examples provided by David in <a class="ext-link" href="https://cf-trac.llnl.gov./140#comment:10"><span class="icon">​</span>https://cf-trac.llnl.gov./140#comment:10</a> should also be included.
</p>
<p>
best regards,
</p>
<p>
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-19-1495359863850884">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:19" class="cnum">
    <a href="#comment:19">comment:19</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-21T02%3A44%3A23-07%3A00&amp;precision=second" title="See timeline at 05/21/17 02:44:23">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi Karl, Jonathan,
</p>
<p>
OK - I'll go along that, on the grounds that existing software "should" already cater for both methods. I like the clear wording.
</p>
<p>
If Jonathan agrees, I'll put together in a new comment all of the new text that this ticket implies, plus the examples and conformances.
</p>
<p>
Thanks,
</p>
<p>
David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-20-1495445801596280">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:20" class="cnum">
    <a href="#comment:20">comment:20</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-22T02%3A36%3A41-07%3A00&amp;precision=second" title="See timeline at 05/22/17 02:36:41">4 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Karl and David
</p>
<p>
Yes, that wording is fine, thanks. Instead of "Henceforth" in the final sentence, I'd put "Starting from version 1.7", because this text will remain in future versions, when "Henceforth" would be confusing.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-21-1495449885726669">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:21" class="cnum">
    <a href="#comment:21">comment:21</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-22T03%3A44%3A45-07%3A00&amp;precision=second" title="See timeline at 05/22/17 03:44:45">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
That's good, then - I'll put together the entire set of changes in the next few  days
</p>
<p>
Thanks, David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-22-1495631750900879">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:22" class="cnum">
    <a href="#comment:22">comment:22</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-24T06%3A15%3A50-07%3A00&amp;precision=second" title="See timeline at 05/24/17 06:15:50">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Here are the proposed changes in full:
</p>
<p>
After the first paragraph of section 7.1 Cell Boundaries, add the following three paragraphs and two examples:
</p>
<blockquote>
<p>
Boundary variable attributes which determine the coordinate
type (<tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt> and <tt>positive</tt>) or
those which affect the interpretation of the array values
(<tt>units</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> and
<tt>month_lengths</tt>) must always agree exactly with the same
attributes of its associated coordinate, scalar coordinate or
auxiliary coordinate variable. To avoid duplication, however,
it is recommended that these are not provided to a boundary
variable.
</p>
</blockquote>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt>
attribute (section 4.3.2) also has a bounds attribute, its
boundary variable must have a <tt>formula_terms</tt> attribute
too. In this case the same terms would appear in both (as
specified in Appendix D), since the transformation from the
parametric coordinate values to physical space is realized
through the same formula. For any term that depends on the
vertical dimension, however, the variable names appearing in
the formula terms would differ from those found in the
<tt>formula_terms</tt> attribute of the coordinate variable itself
because the 2-dimensional bound locations do not generally
coincide with the 1-dimensional coordinate locations.
</p>
</blockquote>
<blockquote>
<p>
Whenever a <tt>formula_terms</tt> attribute is attached to a
boundary variable, the formula terms may additionally be
identified using a second method: variables appearing in the
vertical coordinate's <tt>formula_terms</tt> may be declared to be
coordinate, scalar coordinate or auxiliary coordinate
variables, and those coordinates may have <tt>bounds</tt> attributes
that identify their boundary variables. In that case, the
<tt>bounds</tt> attribute of a formula terms variable must be
consistent with the <tt>formula_terms</tt> attribute of the boundary
variable. Software digesting legacy datasets (constructed
prior to version 1.7 of this standard) may have to rely in
some cases on the first method of identifying the formula
term variables and in other cases, on the second. Starting
from version 1.7, however, the first method will be
sufficient.
</p>
</blockquote>
<blockquote>
<p>
<strong>Example:</strong> Specifying <tt>formula_terms</tt> on a boundary variable when the named variables that depend on the vertical dimension are not associated with coordinate, scalar coordinate or auxiliary coordinate variables.
</p>
</blockquote>
<pre class="wiki"> float eta(eta) ;
   eta:long_name = "eta at half levels" ;
   eta:positive = "down" ;
   eta:standard_name = "atmosphere_hybrid_sigma_pressure_coordinate" ;
   eta:formula_terms = "a: A b: B ps: PS p0: P0" ;
   eta:bounds="eta_bnds" ;
 float eta_bnds(eta, 2) ;
   eta_bnds:formula_terms = "a: A_full b: B_full ps: PS p0: P0" ;
 float A(eta) ;
   A:long_name = "'a' coefficient for vertical coordinate at half levels" ;
   A:units = "Pa" ;
 float B(eta) ;
   B:long_name = "'b' coefficient for vertical coordinate at half levels" ;
   B:units = "1" ;
 float A_full(eta, 2) ;
   A_full:long_name = "'a' coefficient for vertical coordinate at full levels" ;
   A_full:units = "Pa" ;
 float B_full(eta, 2) ;
   B_full:long_name = "'a' coefficient for vertical coordinate at full levels" ;
   B_full:units = "1" ;
 float PS(lat, lon) ;
   PS.units = 'Pa' ;
 float P0 ; 
   P0.units = 'Pa' ;
 float temp(eta, lat, lon) ;
   temp:standard_name = "air_temperature" ;
   temp:units = "K" ;
</pre><blockquote>
<p>
<strong>Example:</strong> Specifying <tt>formula_terms</tt> on a boundary variable when the named variables that depend on the vertical dimension contain boundary values to auxiliary coordinate variables.
</p>
</blockquote>
<pre class="wiki"> float eta(eta) ;
   eta:long_name = "eta at half levels" ;
   eta:positive = "down" ;
   eta:standard_name = " atmosphere_hybrid_sigma_pressure_coordinate" ;
   eta:formula_terms = "a: A b: B ps: PS p0: P0" ;
   eta:bounds="eta_bnds" ;
 float eta_bnds(eta, 2) ;
   eta_bnds:formula_terms = "a: A_bnds b: B_bnds ps: PS p0: P0" ;
 float A(eta) ;
   A:long_name = "'a' coefficient for vertical coordinate at full levels" ;
   A:units = "Pa" ;
   A:bounds = "A_bnds" ;
 float B(eta) ;
   B:long_name = "'b' coefficient for vertical coordinate at full levels" ;
   B:units = "1" ;
   B:bounds = "B_bnds" ;	
 float A_bnds(eta, 2) ;
 float B_bnds(eta, 2) ;
 float PS(lat, lon) ;
   PS.units = 'Pa' ;
 float P0 ; 
   P0.units = 'Pa' ;
 float temp(eta, lat, lon) ;
   temp:standard_name = "air_temperature" ;
   temp:units = "K";
   temp:coordinates = "A B" ;
</pre><p>
The conformance document is to be changed as follows:
</p>
<p>
In section 7.1 Cell Boundaries: 
</p>
<p>
Replace requirement "If a boundary variable has <tt>units</tt> or <tt>standard_name</tt> attributes, they must agree with those of its associated variable." with
</p>
<blockquote>
<p>
If a boundary variable has <tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt>,
<tt>positive</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> or
<tt>month_lengths</tt> attributes, they must agree with those of its
associated variable.
</p>
</blockquote>
<p>
Add a new requirement (<em>This requirement is backwards incompatible</em>):
</p>
<blockquote>
<p>
Starting with version 1.7, a boundary variable must have a <tt>formula_terms</tt> attribute when
it contains bounds for a parametric vertical coordinate
variable that has a <tt>formula_terms</tt> attribute. In this case the
same terms and named variables must appear in both except for
any term that depends on the vertical dimension, for which the
variable name appearing in the boundary variable's
<tt>formula_terms</tt> must differ from that found in the
<tt>formula_terms</tt> of the coordinate variable itself. In this case,
if the named variable in the <tt>formula_terms</tt> attribute of the
vertical coordinate variable is a coordinate, scalar coordinate
or auxiliary coordinate variable then its <tt>bounds</tt> attribute
must be consistent with the equivalent term in <tt>formula_terms</tt>
attribute of the boundary variable.
</p>
</blockquote>
<p>
Replace recommendation "Boundary variables should not have the <tt>_FillValue</tt> or         <tt>missing_value</tt> attributes." with
</p>
<blockquote>
<p>
Boundary variables should not have the <tt>_FillValue</tt>,
<tt>missing_value</tt>, <tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>,
<tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> or <tt>month_lengths</tt>
attributes.
</p>
</blockquote>
<p>
  
</p>

    </div>

              </div>
              <div class="change" id="trac-change-23-1495648007654659">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:23" class="cnum">
    <a href="#comment:23">comment:23</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-24T10%3A46%3A47-07%3A00&amp;precision=second" title="See timeline at 05/24/17 10:46:47">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi David,
</p>
<p>
Thanks for getting this done so quickly.
</p>
<p>
This looks fine except:
</p>
<p>
In the examples, the half levels should apply to bounds, and the full levels to the coordinate itself.  This is I think always the case for eta with one example provided at:  <a class="ext-link" href="https://rda.ucar.edu/datasets/ds627.2/docs/Eta_coordinate/"><span class="icon">​</span>https://rda.ucar.edu/datasets/ds627.2/docs/Eta_coordinate/</a>  
</p>
<p>
In the 2nd example, wouldn't it be better to label it:  "Linking variables appearing in formula_terms associated with coordinate values with their counterparts associated with the bounds of the coordinates."
</p>
<p>
In the 2nd example, I think we should require the units attribute be defined for both A_bnds and B_bnds.  Otherwise software relying on the now recommended method for defining these would have to figure out the units from the bounds attributes attached to A and B, which is more work.  We would probably also want to tweak the last sentence in the 1st paragraph which states: "To avoid duplication, however, it is recommended that these are not provided to a boundary variable" (since I think in the case of bounds attached to formula term variables, I think the units should be provided).  
</p>
<p>
best regards,
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-24-1495698882297638">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:24" class="cnum">
    <a href="#comment:24">comment:24</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-25T00%3A54%3A42-07%3A00&amp;precision=second" title="See timeline at 05/25/17 00:54:42">4 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear David and Karl
</p>
<p>
Thanks for doing this, David.
</p>
<p>
I agree with Karl that it would seem more obvious and usual to have the half-levels as bounds in the examples.
</p>
<p>
The two examples are of course very similar. I can imagine a reader glancing at them and thinking they <em>are</em> the same, and being consequently puzzled, or poring over them to spot the differences, as I have just been doing. :-) The titles of the examples are not easy to understand, I would say, and therefore don't help very much. I suggest solving these difficulties by having only one example, labelled something like "Specifying <tt>formula_terms</tt> when a parametric coordinate variable has bounds", in which you give the <tt>bounds</tt> attributes of the formula terms variables and the <tt>coordinates</tt> attribute of the data variable a CDL comment such as <tt>// This attribute is included for the optional second method</tt>. You could perhaps also comment on the <tt>formula_terms</tt> of the bounds <tt>// This attribute is mandatory</tt>.
</p>
<p>
I'm sorry to say that I might disagree with Karl's final comment. I hope this isn't going to break our consensus! Actually I hadn't thought of this consequence before, which relates to our different views about the paths to formula terms, and indeed the original motive for this ticket. David and I feel that bounds variables are closely related to their parent variables, and the natural route to a bounds variable is via its parent; therefore they can share attributes, including <tt>units</tt> and <tt>standard_name</tt>. Thus Karl's requirement would contradict the first paragraph if the formula terms have bounds, as you say, Karl. What do you think, David? Karl, is there a use-case in which you are dealing with <tt>eta_bnds</tt> without being aware of <tt>eta</tt>?
</p>
<p>
In the second paragraph, we currently have, "the variable names appearing in the formula terms would differ from those found in the formula_terms attribute of the coordinate variable itself because the 2-dimensional bound locations do not generally coincide with the 1-dimensional coordinate locations." I think we can state this more strongly and clearly, "... because the boundary variables for formula terms are two-dimensional while the formula terms themselves are one-dimensional." That is, they must be different variables not because the locations are different, though that it is almost certainly the case, but because they have different dimensionality.
</p>
<p>
In the new requirement for the conformance document, can we say something more about the dimensionality of the bounds variable of the formula terms? I think it must have the same dimensions as the formula terms variable, with the addition of the final (CDL) dimension of the coordinate bounds variable.
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-25-1495727848135834">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:25" class="cnum">
    <a href="#comment:25">comment:25</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-25T08%3A57%3A28-07%3A00&amp;precision=second" title="See timeline at 05/25/17 08:57:28">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear David and Jonathan,
</p>
<p>
I like Jonathan's idea to combine both examples and annotate it.
</p>
<p>
I don't think it important to *require* the units attributes to be included with the parametric bounds variables, so let's not worry about my "final comment".  For the record, I think the most common use case where one might care only about the eta bounds and not eta is in performing a mass-weighted vertical integral of a quantity.  One would need the values of the quantity being integrated and the eta-bounds.  The eta-bounds would be transformed to pressure using the the formula terms attached to eta-bounds.  The pressure "widths" of each cell could then be calculated and multiplied by the variable being integrated; then summed.  There would be no need to know anything about eta itself.  Of course, in this procedure there would be no need to know anything about the parametric units either, so it doesn't demand that we make it easy to extract the units associated with A_bnds and B_bnds.
</p>
<p>
I think Jonathan's rewrite of the sentence in the 2nd paragraph is an improvement.
</p>
<p>
I think we must be about "there".
</p>
<p>
best wishes,
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-26-1495787990806964">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:26" class="cnum">
    <a href="#comment:26">comment:26</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-26T01%3A39%3A50-07%3A00&amp;precision=second" title="See timeline at 05/26/17 01:39:50">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Karl and Jonathan,
</p>
<p>
I agree with all of your suggestions and changes. I hope that I have parsed them correctly and that we are indeed "there". The proposed changes, in full, are now: 
</p>
<p>
After the first paragraph of section 7.1 Cell Boundaries, add the following three paragraphs and two examples:
</p>
<blockquote>
<p>
Boundary variable attributes which determine the coordinate type (<tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt> and <tt>positive</tt>) or those which affect the interpretation of the array values (<tt>units</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> and <tt>month_lengths</tt>) must always agree exactly with the same attributes of its associated coordinate, scalar coordinate or auxiliary coordinate variable. To avoid duplication, however, it is recommended that these are not provided to a boundary variable.
</p>
</blockquote>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt> attribute (section 4.3.2) also has a <tt>bounds</tt> attribute, its boundary variable must have a <tt>formula_terms</tt> attribute too. In this case the same terms would appear in both (as specified in Appendix D), since the transformation from the parametric coordinate values to physical space is realized through the same formula. For any term that depends on the vertical dimension, however, the variable names appearing in the formula terms would differ from those found in the <tt>formula_terms</tt> attribute of the coordinate variable itself because the boundary variables for formula terms are two-dimensional while the formula terms themselves are one-dimensional.
</p>
</blockquote>
<blockquote>
<p>
Whenever a <tt>formula_terms</tt> attribute is attached to a boundary variable, the formula terms may additionally be identified using a second method: variables appearing in the vertical coordinate's <tt>formula_terms</tt> may be declared to be coordinate, scalar coordinate or auxiliary coordinate variables, and those coordinates may have bounds attributes that identify their boundary variables. In that case, the bounds attribute of a formula terms variable must be consistent with the <tt>formula_terms</tt> attribute of the boundary variable. Software digesting legacy datasets (constructed prior to version 1.7 of this standard) may have to rely in some cases on the first method of identifying the formula term variables and in other cases, on the second. Starting from version 1.7, however, the first method will be sufficient.
</p>
</blockquote>
<blockquote>
<p>
<strong>Example:</strong> Specifying <tt>formula_terms</tt> when a parametric coordinate variable has bounds.
</p>
</blockquote>
<pre class="wiki"> float eta(eta) ;
   eta:long_name = "eta at full levels" ;
   eta:positive = "down" ;
   eta:standard_name = " atmosphere_hybrid_sigma_pressure_coordinate" ;
   eta:formula_terms = "a: A b: B ps: PS p0: P0" ;
   eta:bounds="eta_bnds" ; 
 float eta_bnds(eta, 2) ;
   eta_bnds:formula_terms = "a: A_bnds b: B_bnds ps: PS p0: P0" ; // This attribute is mandatory 
 float A(eta) ;
   A:long_name = "'a' coefficient for vertical coordinate at full levels" ;
   A:units = "Pa" ;
   A:bounds = "A_bnds" ; // This attribute is included for the optional second method
 float B(eta) ;
   B:long_name = "'b' coefficient for vertical coordinate at full levels" ;
   B:units = "1" ;
   B:bounds = "B_bnds" ; // This attribute is included for the optional second method
 float A_bnds(eta, 2) ;
 float B_bnds(eta, 2) ;
 float PS(lat, lon) ;
   PS.units = "Pa" ;
 float P0 ; 
   P0.units = "Pa" ;
 float temp(eta, lat, lon) ;
   temp:standard_name = "air_temperature" ;
   temp:units = "K";
   temp:coordinates = "A B" ; // This attribute is included for the optional second method
</pre><p>
The conformance document is to be changed as follows:
</p>
<p>
In section 7.1 Cell Boundaries:
</p>
<p>
Replace requirement "If a boundary variable has <tt>units</tt> or <tt>standard_name</tt> attributes, they must agree with those of its associated variable." with
</p>
<blockquote>
<p>
If a boundary variable has <tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> or <tt>month_lengths</tt> attributes, they must agree with those of its associated variable.
</p>
</blockquote>
<p>
Add a new requirement (This requirement is backwards incompatible):
</p>
<blockquote>
<p>
Starting with version 1.7, a boundary variable must have a <tt>formula_terms</tt> attribute when it contains bounds for a parametric vertical coordinate variable that has a <tt>formula_terms</tt> attribute. In this case the same terms and named variables must appear in both except for any term that depends on the vertical dimension, for which the variable name appearing in the boundary variable's <tt>formula_terms</tt> attribute must differ from that found in the <tt>formula_terms</tt> attribute of the coordinate variable itself. The different variable must have the same dimensions as its associated variable, plus have a trailing dimension (CDL order) for the maximum number of vertices in a cell. If the named variable in the <tt>formula_terms</tt> attribute of the vertical coordinate variable is a coordinate, scalar coordinate or auxiliary coordinate variable then its <tt>bounds</tt> attribute must be consistent with the equivalent term in <tt>formula_terms</tt> attribute of the boundary variable.
</p>
</blockquote>
<p>
Replace recommendation "Boundary variables should not have the <tt>_FillValue</tt> or <tt>missing_value</tt> attributes." with
</p>
<blockquote>
<p>
Boundary variables should not have the <tt>_FillValue</tt>, <tt>missing_value</tt>, <tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> or <tt>month_lengths</tt> attributes.
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-27-1495811428249965">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:27" class="cnum">
    <a href="#comment:27">comment:27</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-26T08%3A10%3A28-07%3A00&amp;precision=second" title="See timeline at 05/26/17 08:10:28">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi David,
</p>
<p>
Looks good to me (except in the example P0.units should be P0:units and PS.units should be PS:units).
</p>
<p>
What a shame we're done with this.  Now we'll have to busy ourselves with less important stuff.
</p>
<p>
cheers,
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-28-1496158160711672">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:28" class="cnum">
    <a href="#comment:28">comment:28</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-30T08%3A29%3A20-07%3A00&amp;precision=second" title="See timeline at 05/30/17 08:29:20">4 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear David
</p>
<p>
Thanks for this. In the preamble, it still says two examples, although there's only one now. "The different variable" is maybe an unclear phrase. You could say explicitly, "The boundary variable of the <tt>formula_terms</tt> variable must have the same dimensions as the <tt>formula_terms</tt> variable, plus a trailing dimension (CDL order) for the maximum number of vertices in a cell, which must be the same as the trailing dimension of the boundary variable of the parametric vertical coordinate variable." I've added the last bit. That's quite a mouthful - I hope digestible, if not palatable.
</p>
<p>
Best wishes and thanks to you and Karl on this successful outcome.
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-29-1496160383878893">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:29" class="cnum">
    <a href="#comment:29">comment:29</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-30T09%3A06%3A23-07%3A00&amp;precision=second" title="See timeline at 05/30/17 09:06:23">4 years ago</a> by taylor13
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
another slight tweak for the sentences under consideration (but you be the judge on whether it makes it any more readable):
</p>
<p>
In this case the same terms and named variables must appear in both except for terms that depend on the vertical dimension.  For such terms the variable name appearing in the boundary variable's formula_terms attribute must differ from that found in the formula_terms attribute of the coordinate variable itself.  The boundary variable of the formula_terms variable must have the same dimensions as the formula_terms variable, plus a trailing dimension (CDL order) for the maximum number of vertices in a cell, which must be the same as the trailing dimension of the boundary variable of the parametric vertical coordinate variable.
</p>
<p>
best,
Karl
</p>

    </div>

              </div>
              <div class="change" id="trac-change-30-1496218188128575">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:30" class="cnum">
    <a href="#comment:30">comment:30</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-05-31T01%3A09%3A48-07%3A00&amp;precision=second" title="See timeline at 05/31/17 01:09:48">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
OK - I like the two proposed changes - thanks to Jonathan and Karl for working on the minutea of this.
</p>
<p>
Here it is again, in full (one thing I've learnt from Jeff's and Tanya's excellent work on the production of 1.7 is that having <em>all</em> the changes in place at the bottom of the ticket is very useful when implementing it - having to trawl the ticket for odd sentences here and there can be difficult).
</p>
<p>
After the first paragraph of section 7.1 Cell Boundaries, add the following three paragraphs and one example:
</p>
<blockquote>
<p>
Boundary variable attributes which determine the coordinate type (<tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt> and <tt>positive</tt>) or those which affect the interpretation of the array values (<tt>units</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> and <tt>month_lengths</tt>) must always agree exactly with the same attributes of its associated coordinate, scalar coordinate or auxiliary coordinate variable. To avoid duplication, however, it is recommended that these are not provided to a boundary variable.
</p>
</blockquote>
<blockquote>
<p>
If a parametric coordinate variable with a <tt>formula_terms</tt> attribute (section 4.3.2) also has a <tt>bounds</tt> attribute, its boundary variable must have a <tt>formula_terms</tt> attribute too. In this case the same terms would appear in both (as specified in Appendix D), since the transformation from the parametric coordinate values to physical space is realized through the same formula. For any term that depends on the vertical dimension, however, the variable names appearing in the formula terms would differ from those found in the <tt>formula_terms</tt> attribute of the coordinate variable itself because the boundary variables for formula terms are two-dimensional while the formula terms themselves are one-dimensional.
</p>
</blockquote>
<blockquote>
<p>
Whenever a <tt>formula_terms</tt> attribute is attached to a boundary variable, the formula terms may additionally be identified using a second method: variables appearing in the vertical coordinates' <tt>formula_terms</tt> may be declared to be coordinate, scalar coordinate or auxiliary coordinate variables, and those coordinates may have <tt>bounds</tt> attributes that identify their boundary variables. In that case, the <tt>bounds</tt> attribute of a formula terms variable must be consistent with the <tt>formula_terms</tt> attribute of the boundary variable. Software digesting legacy datasets (constructed prior to version 1.7 of this standard) may have to rely in some cases on the first method of identifying the formula term variables and in other cases, on the second. Starting from version 1.7, however, the first method will be sufficient.
</p>
</blockquote>
<blockquote>
<p>
Example: Specifying <tt>formula_terms</tt> when a parametric coordinate variable has bounds.
</p>
</blockquote>
<pre class="wiki"> float eta(eta) ;
   eta:long_name = "eta at full levels" ;
   eta:positive = "down" ;
   eta:standard_name = " atmosphere_hybrid_sigma_pressure_coordinate" ;
   eta:formula_terms = "a: A b: B ps: PS p0: P0" ;
   eta:bounds="eta_bnds" ; 
 float eta_bnds(eta, 2) ;
   eta_bnds:formula_terms = "a: A_bnds b: B_bnds ps: PS p0: P0" ; // This attribute is mandatory 
 float A(eta) ;
   A:long_name = "'a' coefficient for vertical coordinate at full levels" ;
   A:units = "Pa" ;
   A:bounds = "A_bnds" ; // This attribute is included for the optional second method
 float B(eta) ;
   B:long_name = "'b' coefficient for vertical coordinate at full levels" ;
   B:units = "1" ;
   B:bounds = "B_bnds" ; // This attribute is included for the optional second method
 float A_bnds(eta, 2) ;
 float B_bnds(eta, 2) ;
 float PS(lat, lon) ;
   PS:units = "Pa" ;
 float P0 ; 
   P0:units = "Pa" ;
 float temp(eta, lat, lon) ;
   temp:standard_name = "air_temperature" ;
   temp:units = "K";
   temp:coordinates = "A B" ; // This attribute is included for the optional second method
</pre><p>
The conformance document is to be changed as follows:
</p>
<p>
In section 7.1 Cell Boundaries:
</p>
<p>
Replace requirement "If a boundary variable has <tt>units</tt> or <tt>standard_name</tt> attributes, they must agree with those of its associated variable." with
</p>
<blockquote>
<p>
If a boundary variable has <tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> or <tt>month_lengths</tt> attributes, they must agree with those of its associated variable.
</p>
</blockquote>
<p>
Add a new requirement (This requirement is backwards incompatible):
</p>
<blockquote>
<p>
Starting with version 1.7, a boundary variable must have a <tt>formula_terms</tt> attribute when it contains bounds for a parametric vertical coordinate variable that has a <tt>formula_terms</tt> attribute. In this case the same terms and named variables must appear in both except for terms that depend on the vertical dimension. For such terms the variable name appearing in the boundary variable's <tt>formula_terms</tt> attribute must differ from that found in the <tt>formula_terms</tt> attribute of the coordinate variable itself. The boundary variable of the <tt>formula_terms</tt> variable must have the same dimensions as the <tt>formula_terms</tt> variable, plus a trailing dimension (CDL order) for the maximum number of vertices in a cell, which must be the same as the trailing dimension of the boundary variable of the parametric vertical coordinate variable. If a named variable in the <tt>formula_terms</tt> attribute of the vertical coordinate variable depends on the vertical dimension and is a coordinate, scalar coordinate or auxiliary coordinate variable then its bounds attribute must be consistent with the equivalent term in <tt>formula_terms</tt> attribute of the boundary variable.
</p>
</blockquote>
<p>
Replace recommendation "Boundary variables should not have the <tt>_FillValue</tt> or <tt>missing_value</tt> attributes." with
</p>
<blockquote>
<p>
Boundary variables should not have the <tt>_FillValue</tt>, <tt>missing_value</tt>, <tt>units</tt>, <tt>standard_name</tt>, <tt>axis</tt>, <tt>positive</tt>, <tt>calendar</tt>, <tt>leap_month</tt>, <tt>leap_year</tt> or <tt>month_lengths</tt> attributes.
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-31-1498669537437221">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:31" class="cnum">
    <a href="#comment:31">comment:31</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-06-28T10%3A05%3A37-07%3A00&amp;precision=second" title="See timeline at 06/28/17 10:05:37">4 years ago</a> by davidhassell
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hello,
</p>
<p>
A consensus has been reached, and the standard three weeks have passed, so I think that we can accept this ticket for inclusion in version 1.7.
</p>
<p>
Many thanks to all who contributed, all the best,
</p>
<p>
David
</p>

    </div>

              </div>
              <div class="change" id="trac-change-32-1499125374003977">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:32" class="cnum">
    <a href="#comment:32">comment:32</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2017-07-03T16%3A42%3A54-07%3A00&amp;precision=second" title="See timeline at 07/03/17 16:42:54">4 years ago</a> by painter1
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-resolution">
      <strong class="trac-field-resolution">Resolution</strong>
        set to <em>fixed</em>
    </li><li class="trac-field-status">
      <strong class="trac-field-status">Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li>
  </ul>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/trac/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="./140?format=rss" class="rss">RSS Feed</a>
        </li><li>
          <a rel="nofollow" href="./140?format=csv" class="csv">Comma-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="./140?format=tab" class="tab">Tab-delimited Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="https://trac.edgewall.org/"><img src="/trac/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/trac/about"><strong>Trac 1.0.20</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the CF Metadata home page at<br /><a href="http://cf-convention.github.io">http://cf-convention.github.io</a><br><font color="#0000ff" size="3"><b>The CF Metadata Trac issue tracker is read-only and will soon be shut down permanently</b></font></p>
    </div>
  </body>
</html>
