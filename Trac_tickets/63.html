<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      #63 (GRIDSPEC: aggregation of block-structured and time dependent data)
     – CF Metadata
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/trac/search" />
        <link rel="prev" href="./62.html" title="ticket #62" />
        <link rel="last" href="./176.html" title="ticket #176" />
        <link rel="help" href="/trac/wiki/TracGuide" />
        <link rel="alternate" href="./63?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" /><link rel="alternate" href="./63?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="./63?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" />
        <link rel="next" href="./64.html" title="ticket #64" />
        <link rel="start" href="/trac/wiki" />
        <link rel="stylesheet" href="/trac/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/trac/chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="./1.html" title="ticket #1" />
        <link rel="shortcut icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="/trac/chrome/common/trac.ico" type="image/x-icon" />
    <style id="trac-noscript" type="text/css">.trac-noscript { display: none !important }</style>
      <link type="application/opensearchdescription+xml" rel="search" href="/trac/search/opensearch" title="Search CF Metadata" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="b8aeac20bf7fd49b63339caa";
      var comments_prefs={"comments_only":"false","comments_order":"oldest"};
    </script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/folding.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/wikitoolbar.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/resizer.js"></script>
      <script type="text/javascript" charset="utf-8" src="/trac/chrome/common/js/auto_preview.js"></script>
    <script type="text/javascript">
      jQuery("#trac-noscript").remove();
      jQuery(document).ready(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <script type="text/javascript" src="/trac/chrome/common/js/threaded_comments.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
      /*<![CDATA[*/
        $("#attachments").toggleClass("collapsed");
        $("#trac-up-attachments").click(function () {
          $("#attachments").removeClass("collapsed");
          return true;
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
        function setRevertHandler() {
          $("button.trac-revert").click(function() {
            var div = $("div", this);
            var field_name = div[0].id.substr(7);
            var field_value = div.text();
            var input = $("#propertyform *[name=field_" + field_name + "]");
            if (input.length > 0) {
              if (input.filter("input[type=radio]").length > 0) {
                input.val([field_value]);
              } else if (input.filter("input[type=checkbox]").length > 0) {
                input.val(field_value == "1" ? [field_value] : []);
              } else {
                input.val(field_value);
              }
            } else { // Special case for CC checkbox
              input = $("#propertyform input[name=cc_update]").val([]);
            }
            input.change();
            $(this).closest("li").remove();
            return false;
          });
        }
        setRevertHandler();
        var comment_focused = false;
        $("#comment").focus(function() { comment_focused = true; })
                     .blur(function() { comment_focused = false; });
        $("#propertyform").autoSubmit({preview: '1'}, function(data, reply) {
          var items = $(reply);
          // Update ticket box
          $("#ticket").replaceWith(items.filter('#ticket'));
          // Update changelog with original order
          $("#changelog").replaceWith(items.filter("#changelog"));
          // Reorder comments
          applyCommentsOrder(
            $('#prefs input[name="trac-comments-order"]:checked').val());
          // Show warning
          var new_changes = $("#changelog .trac-new");
          $("#trac-edit-warning").toggle(new_changes.length != 0);
          if (new_changes.length != 0)
            $("#changelog").parent().show().removeClass("collapsed");
          // Update view time
          $("#propertyform input[name='view_time']").replaceWith(items.filter("input[name='view_time']"));
          // Update preview
          var preview = $("#ticketchange").html(items.filter('#preview').children());
          var show_preview = preview.children().length != 0;
          $("#ticketchange").toggle(show_preview);
          setRevertHandler();
          // Collapse property form if comment editor has focus
          if (show_preview && comment_focused)
            $("#modify").parent().addClass("collapsed");
          // Execute scripts to load stylesheets
          items.filter("script").appendTo("head");
        }, "#ticketchange .trac-loading");
        $("#trac-comment-editor").autoSubmit({preview_comment: '1'}, function(data, reply) {
          var comment = $("#trac-comment-editor").next("div.comment").html(reply);
          comment.toggle(comment.children().length != 0);
        }, "#changelog .trac-loading");
        /*]]>*/
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://cf-trac.llnl.gov/trac"><img src="/trac/chrome/site/cf_logo.png" alt="CF Metadata Trac" height="80" width="400" /></a>
      </div>
      <form id="search" action="/trac/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/trac/login">Login</a></li><li><a href="/trac/about">About Trac</a></li><li><a href="/trac/prefs">Preferences</a></li><li class="last"><a href="/trac/wiki/TracGuide">Help/Guide</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/trac/query">View Tickets</a></li><li><a href="/trac/roadmap">Roadmap</a></li><li><a href="/trac/timeline">Timeline</a></li><li><a href="/trac/search">Search</a></li><li class="last"><a href="/trac/wiki">Wiki</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li class="first"><span>&larr; <a class="prev" href="./62.html" title="ticket #62">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="./64.html" title="ticket #64">Next Ticket</a> &rarr;</span></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
        <div id="ticket" class="trac-content ">
  <div class="date">
    <p>Opened <a class="timeline" href="/trac/timeline?from=2011-01-14T09%3A16%3A11-08%3A00&amp;precision=second" title="See timeline at 01/14/11 09:16:11">10 years ago</a></p>
    <p>Closed <a class="timeline" href="/trac/timeline?from=2011-06-03T14%3A57%3A32-07%3A00&amp;precision=second" title="See timeline at 06/03/11 14:57:32">10 years ago</a></p>
  </div>
  <h2>
    <a href="./63.html" class="trac-id">#63</a>
    <span class="trac-status">
      <a href="/trac/query?status=closed">closed</a>
    </span>
    <span class="trac-type">
      <a href="/trac/query?status=!closed&amp;type=enhancement">enhancement</a>
    </span>
    <span class="trac-resolution">
      (<a href="/trac/query?status=closed&amp;resolution=fixed">fixed</a>)
    </span>
  </h2>
  <h1 id="trac-ticket-title" class="searchable">
    <span class="summary">GRIDSPEC: aggregation of block-structured and time dependent data</span>
  </h1>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable"><a href="/trac/query?status=!closed&amp;reporter=pletzer">pletzer</a></td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">cf-conventions@…</td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/trac/query?status=!closed&amp;priority=medium">medium</a>
        </td>
        <th id="h_milestone" class="missing">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="missing milestone"></a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/trac/query?status=!closed&amp;component=cf-conventions">cf-conventions</a>
        </td>
        <th id="h_version" class="missing">
          Version:
        </th>
        <td headers="h_version">
              <a href="/trac/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="/trac/query?status=!closed&amp;keywords=~gridspec">gridspec</a>, <a href="/trac/query?status=!closed&amp;keywords=~aggregation">aggregation</a>, <a href="/trac/query?status=!closed&amp;keywords=~mosaic">mosaic</a>, <a href="/trac/query?status=!closed&amp;keywords=~tile">tile</a>
        </td>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              <a href="/trac/query?status=!closed&amp;cc=~libcf">libcf</a> <a href="/trac/query?status=!closed&amp;cc=~Development">Development</a> &lt;libcf-devel@…&gt;, V.Balaji@…, <a href="/trac/query?status=!closed&amp;cc=~Jonathan">Jonathan</a> <a href="/trac/query?status=!closed&amp;cc=~Gregory">Gregory</a> &lt;j.m.gregory@…&gt;
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <h1 id="a1.Title">1. Title</h1>
<p>
GRIDSPEC to aggregate block-structured and time dependent data
</p>
<h1 id="a2.Moderator">2. Moderator</h1>
<p>
Balaji (v.balaji@…)
</p>
<h1 id="a3.Requirement">3. Requirement</h1>
<p>
Current conventions support logical rectangular data stored in a single file. The proposed extension will allow users to aggregate data stored in multiple files, whether the data represent different time slices or are associated with different logically rectangular grids as in the case of the cubed sphere mosaic for instance. 
</p>
<h1 id="a4.InitialStatementofTechnicalProposal">4. Initial Statement of Technical Proposal</h1>
<p>
GRIDSPEC comprises of two parts: M-SPEC for representing the grid connectivity in mosaics and F-SPEC for time and mosaic data aggregation. 
</p>
<p>
For M-SPEC, a mosaic file contains the list of files where grid information can be extracted with inter-tile connectivity information provided as a map between the set of indices on one tile to indices on the neighbouring tile. This covers both surfacial and volumetric coupling. The former arises for instance when two three-dimensional grids share a surface while the latter arises when the grids are overlapping. 
</p>
<p>
The F-SPEC describes the format of the host file, which acts as a single entry point to the aggregation. Variable data scattered among many files appear as one logical entity when viewed through the host file. Brittleness, in other words the fragility of the aggregation resulting from inadvertent file corruption, file movement and other file operations, is minimized by consolidating all the file names in the host file, which can be straightforwardly re-generated by scanning directories and inspecting the global attributes of the files residing therein. 
</p>
<h1 id="a5.Benefits">5. Benefits</h1>
<p>
Data producers will be able to store data in multiple files while allowing data consumers to access the data as if all the data were stored in a single file. 
</p>
<p>
A number of codes are moving away from longitude-latitude grids because of the singularity of such grids at the pole, which can cause severe limitations in the maximum time steps than models can take. M-SPEC will allow atmospheric and ocean models to store data on their native grids, without having to incur inaccuracies due to lon-lat regridding. 
</p>
<h1 id="a6.DetailedProposal">6. Detailed Proposal</h1>
<p>
Because of the length of this proposal, a separate <a class="ext-link" href="https://ice.txcorp.com/trac/modave/wiki/CFProposalGridspec"><span class="icon">​</span>web page</a> was created to explain in more details our proposed enhancements. The web page contains many examples and is supported by illustrations. 
</p>

    </div>
  </div>
</div>
          

        <div>
          <div class="trac-noscript" style="position: relative">
            <form id="prefs" method="get" action="/trac/prefs" style="position: absolute; right: 0">
              <div id="trac-comments-order">
                <input type="radio" id="trac-comments-oldest" name="trac-comments-order" value="oldest" checked="checked" />
                <label for="trac-comments-oldest">Oldest first</label>
                <input type="radio" id="trac-comments-newest" name="trac-comments-order" value="newest" />
                <label for="trac-comments-newest">Newest first</label>
                <span id="trac-threaded-toggle" style="display: none">
                  <input type="radio" id="trac-comments-threaded" name="trac-comments-order" value="threaded" />
                  <label for="trac-comments-threaded">Threaded</label>
                </span>
              </div>
              <div>
                <input id="trac-comments-only-toggle" type="checkbox" />
                <label for="trac-comments-only-toggle">Comments only</label>
              </div>
            </form>
          </div>
          <h3 class="foldable">Change History <span class="trac-count">(13)</span></h3>
          <div id="changelog">
              <div class="change" id="trac-change-1-1295874562000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:1" class="cnum">
    <a href="#comment:1">comment:1</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:3" class="follow-up">↓ 3</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-01-24T05%3A09%3A22-08%3A00&amp;precision=second" title="See timeline at 01/24/11 05:09:22">10 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Alex
</p>
<p>
Thank you for making this proposal and for the email discussions we have already had about it, which have cleared up several questions I had. I'd like to raise a few remaining issues.
</p>
<ol><li>I think the attribute name <tt>cf_type_name</tt> for identifying the purpose of variables containing gridspec information is unnecessarily general. Unless you foresee a very closely related application for this attribute, I would suggest you use something less general and hence more informative, such as <tt>gridspec_type_name</tt>.
</li></ol><ol start="2"><li>Please could you clarify whether spaces are allowed or not surrounding <tt>:</tt> in the contact lists? As you know, I would favour allowing space but ignoring it, in order to reduce the number of syntax errors which may occur. I don't think it would make much difference to legibility or parsing.
</li></ol><ol start="3"><li>I think that it should be allowed to contain the grid and/or data from more than one tile in a given file. (In general I think we should be as flexible as possible regarding how things are distributed among files; files are only containers for variables and, as Steve Hankin has pointed out, files are fictional when data is not being served directly from a file store.) To enable that, the <tt>tile_name</tt> would have to be allowed as a variable attribute as an alternative to a global attribute.
</li></ol><ol start="4"><li>I do not see the need to separate static from time-dependent variables. It is easy to tell whether a variable is time-dependent, by examining its coordinates.
</li></ol><p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2-1297202460000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:2" class="cnum">
    <a href="#comment:2">comment:2</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-02-08T14%3A01%3A00-08%3A00&amp;precision=second" title="See timeline at 02/08/11 14:01:00">10 years ago</a> by stevehankin
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
This comment is to follow up on the discussion of the merits of "cf_type_name" versus "gridspec_type_name".  In a separate discussion of the CF Discrete Geometries conventions a very similar need has arisen for an attribute that captures the role that a variable plays within a (complex) CF dataset.  Similar issues have also arisen in the CF satellite conventions and the conventions for unstructured grids (meshes).
</p>
<p>
John Caron has suggested the simpler attribute name, "cf_role" in the context of the Discrete Geometries discussions.  If CF includes a well-managed controlled vocabulary of string values for this attribute, it can satisfy the needs of all of these different conventions, leading to a CF standard that is arguably leaner, cleaner and more easily extensible without the risk of attribute name collisions. 
</p>
<p>
In the case of gridspec I propose that "cf_role" be used in place of "gridspec_type"name" leading to the following controlled vocabulary entries:
</p>
<blockquote>
<p>
o cf_role = "gridspec_coordinate_names"
</p>
</blockquote>
<blockquote>
<p>
o cf_role = "gridspec_tile_contacts"
</p>
</blockquote>
<blockquote>
<p>
o cf_role = "gridspec_contact_map"
</p>
</blockquote>
<blockquote>
<p>
o cf_role = "gridspec_mosaic_filename"
</p>
</blockquote>
<blockquote>
<p>
o cf_role = "gridspec_static_data_filename"
</p>
</blockquote>
<blockquote>
<p>
o cf_role = "gridspec_time_data_filename"
</p>
</blockquote>
<blockquote>
<p>
o cf_role = "gridspec_tile_names"
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-3-1297207433000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:3" class="cnum">
    <a href="#comment:3">comment:3</a>
  </span>
        in reply to:
    <a href="#comment:1">↑ 1</a>
        ;
          <span>follow-ups:</span>
    <a href="#comment:4" class="follow-up">↓ 4</a>
    <a href="#comment:5" class="follow-up">↓ 5</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-02-08T15%3A23%3A53-08%3A00&amp;precision=second" title="See timeline at 02/08/11 15:23:53">10 years ago</a> by pletzer
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi Jonathan,
</p>
<p>
Replying to <a class="ticket" href="./63#comment:1" title="Comment 1">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Dear Alex
</p>
<p>
Thank you for making this proposal and for the email discussions we have already had about it, which have cleared up several questions I had. I'd like to raise a few remaining issues.
</p>
<ol><li>I think the attribute name <tt>cf_type_name</tt> for identifying the purpose of variables containing gridspec information is unnecessarily general. Unless you foresee a very closely related application for this attribute, I would suggest you use something less general and hence more informative, such as <tt>gridspec_type_name</tt>.
</li></ol></blockquote>
<p>
Although I have changed cf_type_name to gridspec_type_name, it appears other people (see comment by S Hankin) have a need for a more general cf_role type attribute. I propose to use cf_role in place gridspec_type_name. We will still name space the *value* of cf_role with gridspec_ (eg gridspec_coordinate_names) to indicate that this particular cf_role is specific to gridspec. I will make the change if ok with you.
</p>
<blockquote class="citation">
<ol start="2"><li>Please could you clarify whether spaces are allowed or not surrounding <tt>:</tt> in the contact lists? As you know, I would favour allowing space but ignoring it, in order to reduce the number of syntax errors which may occur. I don't think it would make much difference to legibility or parsing.
</li></ol></blockquote>
<p>
Yes, allowed and now clarified. 
</p>
<blockquote class="citation">
<ol start="3"><li>I think that it should be allowed to contain the grid and/or data from more than one tile in a given file. (In general I think we should be as flexible as possible regarding how things are distributed among files; files are only containers for variables and, as Steve Hankin has pointed out, files are fictional when data is not being served directly from a file store.) To enable that, the <tt>tile_name</tt> would have to be allowed as a variable attribute as an alternative to a global attribute.
</li></ol></blockquote>
<p>
The assumption of the present design is that the variables which are logically the same (i.e. the same variable but just distributed across tile and time files) share the same name (e.g. "ta"). To allow multiple tile data to be stored in the same file would require assigning different names to the variables. How would you infer that two variables contribute to the same logical variable without adding new attributes other than tile_name? 
</p>
<blockquote class="citation">
<ol start="4"><li>I do not see the need to separate static from time-dependent variables. It is easy to tell whether a variable is time-dependent, by examining its coordinates.
</li></ol></blockquote>
<p>
In the host file, the file names are classified into grid file names, static file names, and time dependent file names because the rank and dimensions for each are different. Each collection of file names is an array of strings. The rank (dimensionality) of the static file name list is nvars_static x ntiles x nstring whereas the dimensionality of the time dependent file name list is ntimes x nvars_timedep x ntiles x nstring. 
</p>
<p>
Thanks for your feedback!
</p>
<p>
--Alex
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4-1297207580000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:4" class="cnum">
    <a href="#comment:4">comment:4</a>
  </span>
        in reply to:
    <a href="#comment:3">↑ 3</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-02-08T15%3A26%3A20-08%3A00&amp;precision=second" title="See timeline at 02/08/11 15:26:20">10 years ago</a> by pletzer
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Steve and Jonanthan,
</p>
<p>
I would feel comfortable with this change.
</p>
<p>
--Alex
</p>
<p>
<strong>'Replying to <a class="ticket" href="./63#comment:3" title="Comment 3">pletzer</a>:
</strong></p>
<blockquote class="citation">
<p>
Hi Jonathan,
</p>
<p>
Replying to <a class="ticket" href="./63#comment:1" title="Comment 1">jonathan</a>:
</p>
<blockquote class="citation">
<p>
Dear Alex
</p>
<p>
Thank you for making this proposal and for the email discussions we have already had about it, which have cleared up several questions I had. I'd like to raise a few remaining issues.
</p>
<ol><li>I think the attribute name <tt>cf_type_name</tt> for identifying the purpose of variables containing gridspec information is unnecessarily general. Unless you foresee a very closely related application for this attribute, I would suggest you use something less general and hence more informative, such as <tt>gridspec_type_name</tt>.
</li></ol></blockquote>
<p>
Although I have changed cf_type_name to gridspec_type_name, it appears other people (see comment by S Hankin) have a need for a more general cf_role type attribute. I propose to use cf_role in place gridspec_type_name. We will still name space the *value* of cf_role with gridspec_ (eg gridspec_coordinate_names) to indicate that this particular cf_role is specific to gridspec. I will make the change if ok with you.
</p>
<blockquote class="citation">
<ol start="2"><li>Please could you clarify whether spaces are allowed or not surrounding <tt>:</tt> in the contact lists? As you know, I would favour allowing space but ignoring it, in order to reduce the number of syntax errors which may occur. I don't think it would make much difference to legibility or parsing.
</li></ol></blockquote>
<p>
Yes, allowed and now clarified. 
</p>
<blockquote class="citation">
<ol start="3"><li>I think that it should be allowed to contain the grid and/or data from more than one tile in a given file. (In general I think we should be as flexible as possible regarding how things are distributed among files; files are only containers for variables and, as Steve Hankin has pointed out, files are fictional when data is not being served directly from a file store.) To enable that, the <tt>tile_name</tt> would have to be allowed as a variable attribute as an alternative to a global attribute.
</li></ol></blockquote>
<p>
The assumption of the present design is that the variables which are logically the same (i.e. the same variable but just distributed across tile and time files) share the same name (e.g. "ta"). To allow multiple tile data to be stored in the same file would require assigning different names to the variables. How would you infer that two variables contribute to the same logical variable without adding new attributes other than tile_name? 
</p>
<blockquote class="citation">
<ol start="4"><li>I do not see the need to separate static from time-dependent variables. It is easy to tell whether a variable is time-dependent, by examining its coordinates.
</li></ol></blockquote>
<p>
In the host file, the file names are classified into grid file names, static file names, and time dependent file names because the rank and dimensions for each are different. Each collection of file names is an array of strings. The rank (dimensionality) of the static file name list is nvars_static x ntiles x nstring whereas the dimensionality of the time dependent file name list is ntimes x nvars_timedep x ntiles x nstring. 
</p>
<p>
Thanks for your feedback!
</p>
<p>
--Alex
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-5-1297332494000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:5" class="cnum">
    <a href="#comment:5">comment:5</a>
  </span>
        in reply to:
    <a href="#comment:3">↑ 3</a>
        ;
          <span>follow-ups:</span>
    <a href="#comment:6" class="follow-up">↓ 6</a>
    <a href="#comment:9" class="follow-up">↓ 9</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-02-10T02%3A08%3A14-08%3A00&amp;precision=second" title="See timeline at 02/10/11 02:08:14">10 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Dear Alex
</p>
<blockquote class="citation">
<p>
Although I have changed cf_type_name to gridspec_type_name, it appears other people (see comment by S Hankin) have a need for a more general cf_role type attribute. I propose to use cf_role in place gridspec_type_name.
</p>
</blockquote>
<p>
I'm still not entirely happy about this, but I do appreciate the arguments in favour of it, so I accept the majority view. My concern is that we must be careful not to use a <tt>cf_role</tt> as a general-purpose dustbin/trashcan attribute in future when we could define something more specific and informative instead.
</p>
<blockquote class="citation">
<blockquote class="citation">
<ol start="2"><li>Please could you clarify whether spaces are allowed or not surrounding <tt>:</tt> in the contact lists? 
</li></ol></blockquote>
<p>
Yes, allowed and now clarified. 
</p>
</blockquote>
<p>
Thank you.
</p>
<blockquote class="citation">
<blockquote class="citation">
<ol start="3"><li>I think that it should be allowed to contain the grid and/or data from more than one tile in a given file. ...
</li></ol></blockquote>
<p>
The assumption of the present design is that the variables which are logically the same (i.e. the same variable but just distributed across tile and time files) share the same name (e.g. "ta"). To allow multiple tile data to be stored in the same file would require assigning different names to the variables. How would you infer that two variables contribute to the same logical variable without adding new attributes other than tile_name?
</p>
</blockquote>
<p>
You would use other metadata, such as <tt>standard_name</tt>. CF explicitly does not standardise variable names (section 2.5). You aren't doing that either, but by depending on the names of variables in this way, gridspec is assigning more meaning to them than CF generally does, though your convention here is rather like the Unidata convention for identifying coordinate variables. I think this restriction is OK, but it could be stated up-front in F-SPEC that the tiles must be in separate files and that variables in those files which contribute to the same logical variable must have the same name. You probably state that - but maybe not prominently enough?
</p>
<blockquote class="citation">
<blockquote class="citation">
<ol start="4"><li>I do not see the need to separate static from time-dependent variables. It is easy to tell whether a variable is time-dependent, by examining its coordinates.
</li></ol></blockquote>
<p>
In the host file, the file names are classified into grid file names, static file names, and time dependent file names because the rank and dimensions for each are different. Each collection of file names is an array of strings. The rank (dimensionality) of the static file name list is nvars_static x ntiles x nstring whereas the dimensionality of the time dependent file name list is ntimes x nvars_timedep x ntiles x nstring.
</p>
</blockquote>
<p>
Since this can be inferred by examining dimensions and coordinates, it's a restriction which could be avoided. However, I accept you are not trying to solve the most general problem.
</p>
<p>
One other comment: Please could you append to the document a listing of the additions and changes which should be made to the CF conformance document <a class="ext-link" href="http://cf-pcmdi.llnl.gov/conformance/requirements-and-recommendations/"><span class="icon">​</span>http://cf-pcmdi.llnl.gov/conformance/requirements-and-recommendations/</a> to support the gridspec proposal?
</p>
<p>
Best wishes
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6-1297448154000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:6" class="cnum">
    <a href="#comment:6">comment:6</a>
  </span>
        in reply to:
    <a href="#comment:5">↑ 5</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-02-11T10%3A15%3A54-08%3A00&amp;precision=second" title="See timeline at 02/11/11 10:15:54">10 years ago</a> by pletzer
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi Jonathan,
</p>
<p>
Replying to <a class="ticket" href="./63#comment:5" title="Comment 5">jonathan</a>:
</p>
<blockquote class="citation">
<blockquote class="citation">
<blockquote class="citation">
<ol start="3"><li>I think that it should be allowed to contain the grid and/or data from more than one tile in a given file. ...
</li></ol></blockquote>
<p>
The assumption of the present design is that the variables which are logically the same (i.e. the same variable but just distributed across tile and time files) share the same name (e.g. "ta"). To allow multiple tile data to be stored in the same file would require assigning different names to the variables. How would you infer that two variables contribute to the same logical variable without adding new attributes other than tile_name?
</p>
</blockquote>
<p>
You would use other metadata, such as <tt>standard_name</tt>. CF explicitly does not standardise variable names (section 2.5). You aren't doing that either, but by depending on the names of variables in this way, gridspec is assigning more meaning to them than CF generally does, though your convention here is rather like the Unidata convention for identifying coordinate variables. I think this restriction is OK, but it could be stated up-front in F-SPEC that the tiles must be in separate files and that variables in those files which contribute to the same logical variable must have the same name. You probably state that - but maybe not prominently enough?
</p>
</blockquote>
<p>
Thanks Jonathan. I agree, that was not clearly expressed. We had 
</p>
<p>
Restriction:
</p>
<ul><li>Time steps must be partitioned into data files in a consistent manner across all tiles.
</li><li>Variables must be partitioned into data files in a consistent manner across all tiles. 
</li></ul><p>
Now we have:
</p>
<p>
Restriction:
</p>
<ul><li>Time steps must be partitioned into data files in a consistent manner across all files. The same partitioning in time is assumed for all tiles and for all time dependent variables.
</li><li>Variables must be partitioned into data files in a consistent manner across all files. The variable names used in the different tile data files and time data files must be the same as there is no other mechanism to identify a collection of variables as belonging to the same logical entity. 
</li></ul><p>
The above restrictions allow one to represent the aggregation in array form suitable for rapid access and time slice indexing.
</p>
<p>
Thanks again for the feedback.
</p>
<p>
Best,
</p>
<p>
--Alex
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7-1298591293000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:7" class="cnum">
    <a href="#comment:7">comment:7</a>
  </span>
          <span>follow-up:</span>
    <a href="#comment:8" class="follow-up">↓ 8</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-02-24T15%3A48%3A13-08%3A00&amp;precision=second" title="See timeline at 02/24/11 15:48:13">10 years ago</a> by caron
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi Alex and all, a few comments on this.
</p>
<p>
First, great job on moving this forward, very important and cool.
</p>
<p>
Now for the nitpicking:
</p>
<ol><li>attribute naming (esp 10.2.2)
</li></ol><p>
I think prefixing all attribute names (global and variable) consistently (eg with "gridspec_") would be good. Then you dont need to prefix attribute values (eg file_type values).
</p>
<ol start="2"><li>terminology (10.3)
</li></ol><p>
You use "structured grid" without defining i think. is this a synonym for "logical rectangular grid" ?
</p>
<ol start="3"><li>curvilinear grid definition (10.3)
</li></ol><p>
"coordinates must be supplied as D-Dimensional objects where D is the number of space dimensions". perhaps "variables" is better than "objects" ? Also, this seems to imply one needs (x,y,z) but a common case is (x,y) x z. 
</p>
<ol start="4"><li>(10.5) Restrictions, 5th paragraph
</li></ol><p>
"multiples of 90 deg in index space" doesnt make much sense to me. indices are just numbers, not sure what "90 deg" refers to.
</p>
<ol start="5"><li>(10.5) encoding of contact ranges
</li></ol><p>
Encoding a series of numbers in ascii seems like a bad idea. why not use 
</p>
<blockquote>
<p>
int contact_range(ncontacts, 4) or something?
</p>
</blockquote>
<ol start="6"><li>(10.5) encoding of contact ranges
</li></ol><p>
Is it needed to allow ranges to go negetive? If not, why not just one encoding, presumably the positive one?
I dont have any real problem with [start, end+1), but i would think [start, end] might be more natural.
</p>
<ol start="7"><li>(10.6.1) file name dependent on OS
</li></ol><p>
I would highly recomend not allowing OS dependencies in your encoding if possible. I would suggest standardizing on "/". 
</p>
<ol start="8"><li>(10.6.1) file name absolute vs reletive
</li></ol><p>
You probably should give an example of reletive file resolution. How does one tell if its absolute or reletive file path? Can CFlib supply a routine which does this, perhaps also converting between canonical and OS form?
</p>
<p>
It would be very helpful to have sample files to look at also.
</p>
<p>
thanks again,
</p>
<p>
John
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8-1298862885000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:8" class="cnum">
    <a href="#comment:8">comment:8</a>
  </span>
        in reply to:
    <a href="#comment:7">↑ 7</a>
        ;
          <span>follow-ups:</span>
    <a href="#comment:10" class="follow-up">↓ 10</a>
    <a href="#comment:11" class="follow-up">↓ 11</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-02-27T19%3A14%3A45-08%3A00&amp;precision=second" title="See timeline at 02/27/11 19:14:45">10 years ago</a> by pletzer
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./63#comment:7" title="Comment 7">caron</a>:
</p>
<blockquote class="citation">
<p>
Hi Alex and all, a few comments on this.
</p>
<p>
First, great job on moving this forward, very important and cool.
</p>
</blockquote>
<p>
Thanks.
</p>
<blockquote class="citation">
<p>
Now for the nitpicking:
</p>
<ol><li>attribute naming (esp 10.2.2)
</li></ol><p>
I think prefixing all attribute names (global and variable) consistently (eg with "gridspec_") would be good. Then you dont need to prefix attribute values (eg file_type values).
</p>
</blockquote>
<p>
After consultation between authors we agree with this change and I have made the change accordingly. All the attributes, be they variable or global, now have the gridspec_ prefix with gridspec_ having been removed from the global attribute values. Thanks for suggesting this improvement.
</p>
<blockquote class="citation">
<ol start="2"><li>terminology (10.3)
</li></ol><p>
You use "structured grid" without defining i think. is this a synonym for "logical rectangular grid" ?
</p>
</blockquote>
<p>
Yes synonymous to logical rectangular grid. Added definition.
</p>
<blockquote class="citation">
<ol start="3"><li>curvilinear grid definition (10.3)
</li></ol><p>
"coordinates must be supplied as D-Dimensional objects where D is the number of space dimensions". perhaps "variables" is better than "objects" ? Also, this seems to imply one needs (x,y,z) but a common case is (x,y) x z. 
</p>
</blockquote>
<p>
Very good point. I think in this case it is sufficient to concentrate on the (x, y) part of the grid since the vertical axis acts as an independent dimension. I will need to add something regarding this case. In the mean time I added the definition of mixed rectilinear-curvilinear grid. 
</p>
<blockquote class="citation">
<ol start="4"><li>(10.5) Restrictions, 5th paragraph
</li></ol><p>
"multiples of 90 deg in index space" doesnt make much sense to me. indices are just numbers, not sure what "90 deg" refers to.
</p>
</blockquote>
<p>
Thanks, clarified. 
</p>
<p>
Two tiles that share a contact must have parallel index axes. This means that contacts can only involve foldings that are multiples of 90 deg. in index space, or equivalently rotation matrices whose elements are either 0, -1, or 1. For instance, the <tt>i</tt> index on one tile can map to the <tt>j</tt> index on the neighboring tile but not to a mixture of <tt>i</tt> and <tt>j</tt> indices. See section 10.5.2 for an example of rotation in index space that is not a multiple of 90 deg.
</p>
<blockquote class="citation">
<ol start="5"><li>(10.5) encoding of contact ranges
</li></ol><p>
Encoding a series of numbers in ascii seems like a bad idea. why not use 
</p>
<blockquote>
<p>
int contact_range(ncontacts, 4) or something?
</p>
</blockquote>
</blockquote>
<p>
A valid point. The idea of using strings would allow us to easily extend the syntax, e.g. by dropping the start of end indices over time. 
</p>
<blockquote class="citation">
<ol start="6"><li>(10.5) encoding of contact ranges
</li></ol><p>
Is it needed to allow ranges to go negetive? If not, why not just one encoding, presumably the positive one?
</p>
</blockquote>
<p>
Yes it is required because of the folding between tile such that i maps to a decreasing j, for instance. 
</p>
<blockquote class="citation">
<p>
I dont have any real problem with [start, end+1), but i would think [start, end] might be more natural.
</p>
</blockquote>
<p>
It could be more natural in the sense that the reverse iterator [end, start] would appear symmetric to [start, end]. Let put this to the vote.
</p>
<blockquote class="citation">
<ol start="7"><li>(10.6.1) file name dependent on OS
</li></ol><p>
I would highly recomend not allowing OS dependencies in your encoding if possible. I would suggest standardizing on "/". 
</p>
</blockquote>
<p>
Sure, would simplify the doc but complicate the API. Let me think about this...
</p>
<blockquote class="citation">
<ol start="8"><li>(10.6.1) file name absolute vs reletive
</li></ol><p>
You probably should give an example of reletive file resolution. How does one tell if its absolute or reletive file path? Can CFlib supply a routine which does this, perhaps also converting between canonical and OS form?
</p>
</blockquote>
<p>
Would certainly be possible.
</p>
<blockquote class="citation">
<p>
It would be very helpful to have sample files to look at also.
</p>
</blockquote>
<p>
We have some unit tests that run within libcf and which exercise mosaic data aggregation. The wiki contains some examples, which are admittedly short but complete.
</p>
<p>
Thanks John for careful reading and for your suggestions. 
</p>
<p>
--Alex
</p>
<blockquote class="citation">
<p>
thanks again,
</p>
<p>
John
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-9-1298863035000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:9" class="cnum">
    <a href="#comment:9">comment:9</a>
  </span>
        in reply to:
    <a href="#comment:5">↑ 5</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-02-27T19%3A17%3A15-08%3A00&amp;precision=second" title="See timeline at 02/27/11 19:17:15">10 years ago</a> by pletzer
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi Jonathan,
</p>
<p>
Replying to <a class="ticket" href="./63#comment:5" title="Comment 5">jonathan</a>:
</p>
<blockquote class="citation">
<p>
One other comment: Please could you append to the document a listing of the additions and changes which should be made to the CF conformance document <a class="ext-link" href="http://cf-pcmdi.llnl.gov/conformance/requirements-and-recommendations/"><span class="icon">​</span>http://cf-pcmdi.llnl.gov/conformance/requirements-and-recommendations/</a> to support the gridspec proposal?
</p>
</blockquote>
<p>
Done, see paragraph 10.7. 
</p>
<p>
Best regards,
</p>
<p>
--Alex
</p>
<blockquote class="citation">
<p>
Best wishes
</p>
<p>
Jonathan
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-10-1300120238000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:10" class="cnum">
    <a href="#comment:10">comment:10</a>
  </span>
        in reply to:
    <a href="#comment:8">↑ 8</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-03-14T09%3A30%3A38-07%3A00&amp;precision=second" title="See timeline at 03/14/11 09:30:38">10 years ago</a> by pletzer
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Replying to <a class="ticket" href="./63#comment:8" title="Comment 8">pletzer</a>:
</p>
<blockquote class="citation">
<p>
Replying to <a class="ticket" href="./63#comment:7" title="Comment 7">caron</a>:
</p>
</blockquote>
<p>
Hi John,
</p>
<p>
Following your recommendation, the syntax for expressing ranges has been changed so that the end indices are now inclusive, ie containing the last valid index.  The change has been propagated to the wiki and to LibCF. Thanks for your suggestion.
</p>
<p>
--Alex
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11-1300136108000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:11" class="cnum">
    <a href="#comment:11">comment:11</a>
  </span>
        in reply to:
    <a href="#comment:8">↑ 8</a>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-03-14T13%3A55%3A08-07%3A00&amp;precision=second" title="See timeline at 03/14/11 13:55:08">10 years ago</a> by pletzer
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
Hi John,
</p>
<blockquote class="citation">
<blockquote class="citation">
<ol start="7"><li>(10.6.1) file name dependent on OS
</li></ol><p>
I would highly recomend not allowing OS dependencies in your encoding if possible. I would suggest standardizing on "/". 
</p>
</blockquote>
</blockquote>
<p>
The need for '/' exists only in the host file, the only file allowed to refer explicitly to a file name. The host file is not meant to be ported to another platform. F-SPEC allows for a cheap (re-)generation of the host file, should the files be transferred to another platform. 
</p>
<p>
Only in the cases where a file system is made globally accessible through NFS or some other mechanism would it make sense to write the data in the host file in portable way across Unix-Windows. In such a case, it should be sufficient to run the application from a cygwin window to convert '/' to '\'.
</p>
<p>
The issue of converting '/' automatically to '\' on Windows sounds easy but there are subtle issues related to file path portability that cannot be addressed simply. What to do with "C:\" or the case sensitivity of some file systems (incl. Mac OS X) ? What if the host file lists Foo.nc and foo.nc? Perfectly valid on unix bt perhaps not on Windows. 
</p>
<p>
For the above reasons, we prefer to leave the responsibility to encode correct the file paths to the application that generates the host file for the time being.
</p>
<p>
Thanks for your suggestions. 
</p>
<p>
Best,
</p>
<p>
--Alex
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12-1304532961000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:12" class="cnum">
    <a href="#comment:12">comment:12</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-05-04T11%3A16%3A01-07%3A00&amp;precision=second" title="See timeline at 05/04/11 11:16:01">10 years ago</a> by jonathan
  </h3>
  <div class="trac-ticket-buttons">
  </div>
    <div class="comment searchable">
      <p>
There haven't been any further objections or comments for more than three weeks, so the moderator of the ticket (Balaji) could declare this change to be accepted according to the rules.
</p>
<p>
Jonathan
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13-1307138252000000">
                
  <h3 class="change">
    <span class="threading">
      <span id="comment:13" class="cnum">
    <a href="#comment:13">comment:13</a>
  </span>
    </span>
        Changed <a class="timeline" href="/trac/timeline?from=2011-06-03T14%3A57%3A32-07%3A00&amp;precision=second" title="See timeline at 06/03/11 14:57:32">10 years ago</a> by balaji
  </h3>
  <div class="trac-ticket-buttons">
  </div>
  <ul class="changes">
    <li class="trac-field-resolution">
      <strong class="trac-field-resolution">Resolution</strong>
        set to <em>fixed</em>
    </li><li class="trac-field-status">
      <strong class="trac-field-status">Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      <p>
There have been no comments on the Trac over the approval period. All changes on the ticket have been incorporated into the <a class="ext-link" href="https://ice.txcorp.com/trac/modave/wiki/CFProposalGridspec"><span class="icon">​</span>CF Gridspec proposal web page</a>. As moderator I propose that this change be accepted and incorporated in to the next CF release.
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/trac/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="./63?format=rss" class="rss">RSS Feed</a>
        </li><li>
          <a rel="nofollow" href="./63?format=csv" class="csv">Comma-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="./63?format=tab" class="tab">Tab-delimited Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="https://trac.edgewall.org/"><img src="/trac/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/trac/about"><strong>Trac 1.0.20</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the CF Metadata home page at<br /><a href="http://cf-convention.github.io">http://cf-convention.github.io</a><br><font color="#0000ff" size="3"><b>The CF Metadata Trac issue tracker is read-only and will soon be shut down permanently</b></font></p>
    </div>
  </body>
</html>
